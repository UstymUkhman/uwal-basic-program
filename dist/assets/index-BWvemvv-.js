(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const f of o)if(f.type==="childList")for(const S of f.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&r(S)}).observe(document,{childList:!0,subtree:!0});function e(o){const f={};return o.integrity&&(f.integrity=o.integrity),o.referrerPolicy&&(f.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?f.credentials="include":o.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function r(o){if(o.ep)return;o.ep=!0;const f=e(o);fetch(o.href,f)}})();var Hr=Object.defineProperty,yr=i=>{throw TypeError(i)},Qr=(i,t,e)=>t in i?Hr(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,De=(i,t,e)=>Qr(i,typeof t!="symbol"?t+"":t,e),In=(i,t,e)=>t.has(i)||yr("Cannot "+e),M=(i,t,e)=>(In(i,t,"read from private field"),e?e.call(i):t.get(i)),$=(i,t,e)=>t.has(i)?yr("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),L=(i,t,e,r)=>(In(i,t,"write to private field"),t.set(i,e),e),ft=(i,t,e)=>(In(i,t,"access private method"),e),he,le,_e,Jt;const $r=class gr{constructor(t=0,e,r,o=255){$(this,he,0),$(this,le,0),$(this,_e,0),$(this,Jt,1),typeof e=="number"&&typeof r=="number"?this.RGBA=[t,e,r,o]:(L(this,he,(t>>16&255)/255),L(this,le,(t>>8&255)/255),L(this,_e,(t&255)/255),L(this,Jt,o/255))}Premultiply(t,e){e??(e=new gr),t??(t=M(this,Jt));const r=M(this,he)*t,o=M(this,le)*t,f=M(this,_e)*t;return e.rgba=[r,o,f,t],e}set rgb(t){L(this,he,t[0]),L(this,le,t[1]),L(this,_e,t[2]),L(this,Jt,t[3]??1)}get rgb(){return[M(this,he),M(this,le),M(this,_e)]}set a(t){L(this,Jt,t)}get a(){return M(this,Jt)}set rgba(t){this.rgb=t}get rgba(){return this.rgb.concat(M(this,Jt))}set RGB(t){L(this,he,t[0]/255),L(this,le,t[1]/255),L(this,_e,t[2]/255),L(this,Jt,(t[3]??255)/255)}get RGB(){return[M(this,he)*255,M(this,le)*255,M(this,_e)*255]}set A(t){L(this,Jt,t/255)}get A(){return M(this,Jt)*255}set RGBA(t){this.RGB=t}get RGBA(){return this.RGB.concat(this.A)}};he=new WeakMap,le=new WeakMap,_e=new WeakMap,Jt=new WeakMap;let Yr=$r;pt({RAD:Math.PI/180,DEG:180/Math.PI,HPI:Math.PI/2,TAU:Math.PI*2});const Zr={CANVAS_NOT_FOUND:"CANVAS_NOT_FOUND",CONTEXT_NOT_FOUND:"CONTEXT_NOT_FOUND",SHADER_CODE_NOT_FOUND:"SHADER_CODE_NOT_FOUND",SHADER_MODULE_NOT_FOUND:"SHADER_MODULE_NOT_FOUND",VERTEX_ENTRY_NOT_FOUND:"VERTEX_ENTRY_NOT_FOUND",VERTEX_ATTRIBUTE_NOT_FOUND:"VERTEX_ATTRIBUTE_NOT_FOUND",RENDER_PASS_NOT_FOUND:"RENDER_PASS_NOT_FOUND",UNIFORM_NOT_FOUND:"UNIFORM_NOT_FOUND",INVALID_UNIFORM_NAME:"INVALID_UNIFORM_NAME",PIPELINE_NOT_FOUND:"PIPELINE_NOT_FOUND",COMMAND_ENCODER_NOT_FOUND:"COMMAND_ENCODER_NOT_FOUND"},jr={CANVAS_NOT_FOUND:"Failed to get a WebGPU canvas.",CONTEXT_NOT_FOUND:"Failed to get a WebGPU context.",SHADER_CODE_NOT_FOUND:`Failed to get a WGSL shader when creating shader module.
        An empty shader will be used instead.`,SHADER_MODULE_NOT_FOUND:"Failed to get shader module in ",VERTEX_ENTRY_NOT_FOUND:"Failed to find function ",VERTEX_ATTRIBUTE_NOT_FOUND:"Failed to find vertex attribute ",RENDER_PASS_NOT_FOUND:"Failed to use pipeline in render pass because it has not started.",UNIFORM_NOT_FOUND:"Failed to find uniform ",INVALID_UNIFORM_NAME:"Requested uniform is already in use and managed internally: ",PIPELINE_NOT_FOUND:"Failed to get a GPU",COMMAND_ENCODER_NOT_FOUND:"Failed to get a GPUCommandEncoder."},Jr={CANVAS_NOT_FOUND:5,CONTEXT_NOT_FOUND:6,PIPELINE_NOT_FOUND:7,COMMAND_ENCODER_NOT_FOUND:8},Kr={RENDER_PIPELNE_NOT_FOUND:"RENDER_PIPELNE_NOT_FOUND",TEXTURE_SIZE_NOT_FOUND:"TEXTURE_SIZE_NOT_FOUND",TEXTURE_NOT_FOUND:"TEXTURE_NOT_FOUND"},ts={RENDER_PIPELNE_NOT_FOUND:'"UWAL.RenderPipeline" instance is required in `Texture` when generating mipmaps.\n        Pass it to the `Texture` constructor or use `Texture.Renderer` setter before creating a ',TEXTURE_SIZE_NOT_FOUND:"`size` array or a `width` value is required in `options` parameter of ",TEXTURE_NOT_FOUND:'"CopyImageToTexture" `options` is required to have a `texture` value or\n        its `create` entry to be either true or a `TextureDescriptor` object.'},es={REQUIRED_SEGMENTS:"REQUIRED_SEGMENTS"},ns={REQUIRED_SEGMENTS:"Shape `segments` is required to be an integer value."};pt({DEVICE_LOST:"Device::Lost"});const ot=pt({FORMAT_NOT_SUPPORTED:"FORMAT_NOT_SUPPORTED",WEBGPU_NOT_SUPPORTED:"WEBGPU_NOT_SUPPORTED",ADAPTER_NOT_FOUND:"ADAPTER_NOT_FOUND",FEATURE_NOT_FOUND:"FEATURE_NOT_FOUND",DEVICE_NOT_FOUND:"DEVICE_NOT_FOUND",DEVICE_NOT_REQUESTED:"DEVICE_NOT_REQUESTED",DEVICE_LOST:"DEVICE_LOST",...Zr,...Kr,...es}),kr=pt({FORMAT_NOT_SUPPORTED:"Format is not yet supported: ",WEBGPU_NOT_SUPPORTED:"WebGPU is not supported in this browser.",ADAPTER_NOT_FOUND:"Failed to get a GPUAdapter.",DEVICE_NOT_FOUND:"Failed to get a GPUDevice.",FEATURE_NOT_FOUND:"Failed to get a GPUFeature ",DEVICE_NOT_REQUESTED:"GPUDevice was not requested.",DEVICE_LOST:"WebGPU device was lost. ",...jr,...ts,...ns}),rs=pt({WEBGPU_NOT_SUPPORTED:0,ADAPTER_NOT_FOUND:1,DEVICE_NOT_FOUND:2,DEVICE_NOT_REQUESTED:3,DEVICE_LOST:4,...Jr});function Me(i,t){console.warn(kr[i]+(t??""))}function lt(i,t){throw new Error(kr[i]+(t??""),{cause:rs[i]})}function pt(i){for(let t in i)i[t]={value:i[t]};return Object.freeze(Object.create(null,i))}function ss(i){switch(i){case 2:return"unorm8x2";case 4:return"float32";case 8:return"float32x2";case 12:return"float32x3";case 16:return"float32x4"}}function is(i){switch(i){case"uint8x2":case"sint8x2":case"unorm8x2":case"snorm8x2":return 2;case"uint32":case"sint32":case"float32":case"uint8x4":case"sint8x4":case"unorm8x4":case"snorm8x4":case"uint16x2":case"sint16x2":case"unorm16x2":case"snorm16x2":case"float16x2":return 4;case"uint16x4":case"sint16x4":case"uint32x2":case"sint32x2":case"unorm16x4":case"snorm16x4":case"float16x4":case"float32x2":return 8;case"uint32x3":case"sint32x3":case"float32x3":return 12;case"uint32x4":case"sint32x4":case"float32x4":return 16}return 0}function as(i){return i==="f16"||i.includes("h")?"f16":i.includes("f")?"f32":i.includes("u")?"u32":"i32"}function os(i){return+i.slice(1)/8}function us(i){return i==="f16"&&lt(ot.FORMAT_NOT_SUPPORTED,`${i}.`),i==="f32"?Float32Array:i==="u32"?Uint32Array:Int32Array}const Xn={operation:"add",srcFactor:"one",dstFactor:"zero"},Hn={operation:"add",srcFactor:"one",dstFactor:"one"},Qn={operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"},$n={operation:"add",srcFactor:"one-minus-dst-alpha",dstFactor:"one"},Yn={operation:"add",srcFactor:"dst-alpha",dstFactor:"zero"},Zn={operation:"add",srcFactor:"zero",dstFactor:"src-alpha"},jn={operation:"add",srcFactor:"one-minus-dst-alpha",dstFactor:"zero"},Jn={operation:"add",srcFactor:"zero",dstFactor:"one-minus-src-alpha"},Kn={operation:"add",srcFactor:"dst-alpha",dstFactor:"one-minus-src-alpha"},tr={operation:"add",srcFactor:"one-minus-dst-alpha",dstFactor:"src-alpha"};pt({COPY:pt({color:Xn,alpha:Xn}),ADDITIVE:pt({color:Hn,alpha:Hn}),SOURCE_OVER:pt({color:Qn,alpha:Qn}),DESTINATION_OVER:pt({color:$n,alpha:$n}),SOURCE_IN:pt({color:Yn,alpha:Yn}),DESTINATION_IN:pt({color:Zn,alpha:Zn}),SOURCE_OUT:pt({color:jn,alpha:jn}),DESTINATION_OUT:pt({color:Jn,alpha:Jn}),SOURCE_ATOP:pt({color:Kn,alpha:Kn}),DESTINATION_ATOP:pt({color:tr,alpha:tr})});const cs=pt({UNIFORM:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});class hs{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class ce{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(t){throw new Error("Cannot evaluate node")}evaluateString(t){return this.evaluate(t).toString()}search(t){}searchBlock(t,e){if(t){e(kn.instance);for(const r of t)r instanceof Array?this.searchBlock(r,e):r.search(e);e(xn.instance)}}}class kn extends ce{}kn.instance=new kn;class xn extends ce{}xn.instance=new xn;class _t extends ce{constructor(){super()}}class Mn extends _t{constructor(t,e,r,o,f,S){super(),this.calls=new Set,this.name=t,this.args=e,this.returnType=r,this.body=o,this.startLine=f,this.endLine=S}get astNodeType(){return"function"}search(t){this.searchBlock(this.body,t)}}class ls extends _t{constructor(t){super(),this.expression=t}get astNodeType(){return"staticAssert"}search(t){this.expression.search(t)}}class _s extends _t{constructor(t,e){super(),this.condition=t,this.body=e}get astNodeType(){return"while"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}}class ds extends _t{constructor(t){super(),this.body=t}get astNodeType(){return"continuing"}search(t){this.searchBlock(this.body,t)}}class ps extends _t{constructor(t,e,r,o){super(),this.init=t,this.condition=e,this.increment=r,this.body=o}get astNodeType(){return"for"}search(t){var e,r,o;(e=this.init)===null||e===void 0||e.search(t),(r=this.condition)===null||r===void 0||r.search(t),(o=this.increment)===null||o===void 0||o.search(t),this.searchBlock(this.body,t)}}class Te extends _t{constructor(t,e,r,o,f){super(),this.name=t,this.type=e,this.storage=r,this.access=o,this.value=f}get astNodeType(){return"var"}search(t){var e;t(this),(e=this.value)===null||e===void 0||e.search(t)}}class xr extends _t{constructor(t,e,r){super(),this.name=t,this.type=e,this.value=r}get astNodeType(){return"override"}search(t){var e;(e=this.value)===null||e===void 0||e.search(t)}}class Sn extends _t{constructor(t,e,r,o,f){super(),this.name=t,this.type=e,this.storage=r,this.access=o,this.value=f}get astNodeType(){return"let"}search(t){var e;t(this),(e=this.value)===null||e===void 0||e.search(t)}}class er extends _t{constructor(t,e,r,o,f){super(),this.name=t,this.type=e,this.storage=r,this.access=o,this.value=f}get astNodeType(){return"const"}evaluate(t){return this.value.evaluate(t)}search(t){var e;t(this),(e=this.value)===null||e===void 0||e.search(t)}}var Ie;(function(i){i.increment="++",i.decrement="--"})(Ie||(Ie={}));(function(i){function t(e){const r=e;if(r=="parse")throw new Error("Invalid value for IncrementOperator");return i[r]}i.parse=t})(Ie||(Ie={}));class fs extends _t{constructor(t,e){super(),this.operator=t,this.variable=e}get astNodeType(){return"increment"}search(t){this.variable.search(t)}}var Ye;(function(i){i.assign="=",i.addAssign="+=",i.subtractAssin="-=",i.multiplyAssign="*=",i.divideAssign="/=",i.moduloAssign="%=",i.andAssign="&=",i.orAssign="|=",i.xorAssign="^=",i.shiftLeftAssign="<<=",i.shiftRightAssign=">>="})(Ye||(Ye={}));(function(i){function t(e){const r=e;if(r=="parse")throw new Error("Invalid value for AssignOperator");return r}i.parse=t})(Ye||(Ye={}));class ms extends _t{constructor(t,e,r){super(),this.operator=t,this.variable=e,this.value=r}get astNodeType(){return"assign"}search(t){this.variable.search(t),this.value.search(t)}}class vr extends _t{constructor(t,e){super(),this.name=t,this.args=e}get astNodeType(){return"call"}search(t){for(const e of this.args)e.search(t);t(this)}}class ws extends _t{constructor(t,e){super(),this.body=t,this.continuing=e}get astNodeType(){return"loop"}}class ys extends _t{constructor(t,e){super(),this.condition=t,this.body=e}get astNodeType(){return"body"}}class gs extends _t{constructor(t,e,r,o){super(),this.condition=t,this.body=e,this.elseif=r,this.else=o}get astNodeType(){return"if"}search(t){this.condition.search(t),this.searchBlock(this.body,t),this.searchBlock(this.elseif,t),this.searchBlock(this.else,t)}}class ks extends _t{constructor(t){super(),this.value=t}get astNodeType(){return"return"}search(t){var e;(e=this.value)===null||e===void 0||e.search(t)}}class xs extends _t{constructor(t){super(),this.name=t}get astNodeType(){return"enable"}}class vs extends _t{constructor(t){super(),this.extensions=t}get astNodeType(){return"requires"}}class bs extends _t{constructor(t,e){super(),this.severity=t,this.rule=e}get astNodeType(){return"diagnostic"}}class br extends _t{constructor(t,e){super(),this.name=t,this.type=e}get astNodeType(){return"alias"}}class Es extends _t{constructor(){super()}get astNodeType(){return"discard"}}class Ts extends _t{constructor(){super()}get astNodeType(){return"break"}}class Ms extends _t{constructor(){super()}get astNodeType(){return"continue"}}class Oe extends _t{constructor(t){super(),this.name=t}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class we extends Oe{constructor(t,e,r,o){super(t),this.members=e,this.startLine=r,this.endLine=o}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(t){for(let e=0;e<this.members.length;e++)if(this.members[e].name==t)return e;return-1}}class Er extends Oe{constructor(t,e,r){super(t),this.format=e,this.access=r}get astNodeType(){return"template"}}class Ss extends Oe{constructor(t,e,r,o){super(t),this.storage=e,this.type=r,this.access=o}get astNodeType(){return"pointer"}}class Tr extends Oe{constructor(t,e,r,o){super(t),this.attributes=e,this.format=r,this.count=o}get astNodeType(){return"array"}get isArray(){return!0}}class ze extends Oe{constructor(t,e,r){super(t),this.format=e,this.access=r}get astNodeType(){return"sampler"}}class Kt extends ce{constructor(){super()}}class nr extends Kt{constructor(t){super(),this.value=t}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class Ue extends Kt{constructor(t,e){super(),this.type=t,this.args=e}get astNodeType(){return"createExpr"}search(t){t(this);for(const e of this.args)e.search(t)}}class Mr extends Kt{constructor(t,e){super(),this.name=t,this.args=e}get astNodeType(){return"callExpr"}evaluate(t){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(t));case"acos":return Math.acos(this.args[0].evaluate(t));case"acosh":return Math.acosh(this.args[0].evaluate(t));case"asin":return Math.asin(this.args[0].evaluate(t));case"asinh":return Math.asinh(this.args[0].evaluate(t));case"atan":return Math.atan(this.args[0].evaluate(t));case"atan2":return Math.atan2(this.args[0].evaluate(t),this.args[1].evaluate(t));case"atanh":return Math.atanh(this.args[0].evaluate(t));case"ceil":return Math.ceil(this.args[0].evaluate(t));case"clamp":return Math.min(Math.max(this.args[0].evaluate(t),this.args[1].evaluate(t)),this.args[2].evaluate(t));case"cos":return Math.cos(this.args[0].evaluate(t));case"degrees":return this.args[0].evaluate(t)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(t)-this.args[1].evaluate(t),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(t));case"exp2":return Math.pow(2,this.args[0].evaluate(t));case"floor":return Math.floor(this.args[0].evaluate(t));case"fma":return this.args[0].evaluate(t)*this.args[1].evaluate(t)+this.args[2].evaluate(t);case"fract":return this.args[0].evaluate(t)-Math.floor(this.args[0].evaluate(t));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(t));case"log":return Math.log(this.args[0].evaluate(t));case"log2":return Math.log2(this.args[0].evaluate(t));case"max":return Math.max(this.args[0].evaluate(t),this.args[1].evaluate(t));case"min":return Math.min(this.args[0].evaluate(t),this.args[1].evaluate(t));case"mix":return this.args[0].evaluate(t)*(1-this.args[2].evaluate(t))+this.args[1].evaluate(t)*this.args[2].evaluate(t);case"modf":return this.args[0].evaluate(t)-Math.floor(this.args[0].evaluate(t));case"pow":return Math.pow(this.args[0].evaluate(t),this.args[1].evaluate(t));case"radians":return this.args[0].evaluate(t)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(t));case"sign":return Math.sign(this.args[0].evaluate(t));case"sin":return Math.sin(this.args[0].evaluate(t));case"sinh":return Math.sinh(this.args[0].evaluate(t));case"saturate":return Math.min(Math.max(this.args[0].evaluate(t),0),1);case"smoothstep":return this.args[0].evaluate(t)*this.args[0].evaluate(t)*(3-2*this.args[0].evaluate(t));case"sqrt":return Math.sqrt(this.args[0].evaluate(t));case"step":return this.args[0].evaluate(t)<this.args[1].evaluate(t)?0:1;case"tan":return Math.tan(this.args[0].evaluate(t));case"tanh":return Math.tanh(this.args[0].evaluate(t));case"trunc":return Math.trunc(this.args[0].evaluate(t));default:throw new Error("Non const function: "+this.name)}}search(t){for(const e of this.args)e.search(t);t(this)}}class Nn extends Kt{constructor(t){super(),this.name=t}get astNodeType(){return"varExpr"}search(t){t(this),this.postfix&&this.postfix.search(t)}evaluate(t){const e=t.constants.get(this.name);if(!e)throw new Error("Cannot evaluate node");return e.evaluate(t)}}class rr extends Kt{constructor(t,e){super(),this.name=t,this.initializer=e}get astNodeType(){return"constExpr"}evaluate(t){var e,r;if(this.initializer instanceof Ue){const o=(e=this.postfix)===null||e===void 0?void 0:e.evaluateString(t),f=(r=this.initializer.type)===null||r===void 0?void 0:r.name,S=t.structs.get(f),A=S?.getMemberIndex(o);if(A!=-1)return this.initializer.args[A].evaluate(t);console.log(A)}return this.initializer.evaluate(t)}search(t){this.initializer.search(t)}}class sr extends Kt{constructor(t){super(),this.value=t}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class Ns extends Kt{constructor(t,e){super(),this.type=t,this.value=e}get astNodeType(){return"bitcastExpr"}search(t){this.value.search(t)}}class Os extends Kt{constructor(t,e){super(),this.type=t,this.args=e}get astNodeType(){return"typecastExpr"}evaluate(t){return this.args[0].evaluate(t)}search(t){this.searchBlock(this.args,t)}}class ir extends Kt{constructor(t){super(),this.contents=t}get astNodeType(){return"groupExpr"}evaluate(t){return this.contents[0].evaluate(t)}search(t){this.searchBlock(this.contents,t)}}class As extends Kt{constructor(t){super(),this.index=t}search(t){this.index.search(t)}}class Sr extends Kt{constructor(){super()}}class Ds extends Sr{constructor(t,e){super(),this.operator=t,this.right=e}get astNodeType(){return"unaryOp"}evaluate(t){switch(this.operator){case"+":return this.right.evaluate(t);case"-":return-this.right.evaluate(t);case"!":return this.right.evaluate(t)?0:1;case"~":return~this.right.evaluate(t);default:throw new Error("Unknown unary operator: "+this.operator)}}search(t){this.right.search(t)}}class te extends Sr{constructor(t,e,r){super(),this.operator=t,this.left=e,this.right=r}get astNodeType(){return"binaryOp"}evaluate(t){switch(this.operator){case"+":return this.left.evaluate(t)+this.right.evaluate(t);case"-":return this.left.evaluate(t)-this.right.evaluate(t);case"*":return this.left.evaluate(t)*this.right.evaluate(t);case"/":return this.left.evaluate(t)/this.right.evaluate(t);case"%":return this.left.evaluate(t)%this.right.evaluate(t);case"==":return this.left.evaluate(t)==this.right.evaluate(t)?1:0;case"!=":return this.left.evaluate(t)!=this.right.evaluate(t)?1:0;case"<":return this.left.evaluate(t)<this.right.evaluate(t)?1:0;case">":return this.left.evaluate(t)>this.right.evaluate(t)?1:0;case"<=":return this.left.evaluate(t)<=this.right.evaluate(t)?1:0;case">=":return this.left.evaluate(t)>=this.right.evaluate(t)?1:0;case"&&":return this.left.evaluate(t)&&this.right.evaluate(t)?1:0;case"||":return this.left.evaluate(t)||this.right.evaluate(t)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(t){this.left.search(t),this.right.search(t)}}class Nr extends ce{constructor(){super()}}class Cs extends Nr{constructor(t,e){super(),this.selector=t,this.body=e}get astNodeType(){return"case"}search(t){this.searchBlock(this.body,t)}}class Us extends Nr{constructor(t){super(),this.body=t}get astNodeType(){return"default"}search(t){this.searchBlock(this.body,t)}}class Rs extends ce{constructor(t,e,r){super(),this.name=t,this.type=e,this.attributes=r}get astNodeType(){return"argument"}}class Fs extends ce{constructor(t,e){super(),this.condition=t,this.body=e}get astNodeType(){return"elseif"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}}class Ps extends ce{constructor(t,e,r){super(),this.name=t,this.type=e,this.attributes=r}get astNodeType(){return"member"}}class qs extends ce{constructor(t,e){super(),this.name=t,this.value=e}get astNodeType(){return"attribute"}}var T,g;(function(i){i[i.token=0]="token",i[i.keyword=1]="keyword",i[i.reserved=2]="reserved"})(g||(g={}));class x{constructor(t,e,r){this.name=t,this.type=e,this.rule=r}toString(){return this.name}}class h{}T=h;h.none=new x("",g.reserved,"");h.eof=new x("EOF",g.token,"");h.reserved={asm:new x("asm",g.reserved,"asm"),bf16:new x("bf16",g.reserved,"bf16"),do:new x("do",g.reserved,"do"),enum:new x("enum",g.reserved,"enum"),f16:new x("f16",g.reserved,"f16"),f64:new x("f64",g.reserved,"f64"),handle:new x("handle",g.reserved,"handle"),i8:new x("i8",g.reserved,"i8"),i16:new x("i16",g.reserved,"i16"),i64:new x("i64",g.reserved,"i64"),mat:new x("mat",g.reserved,"mat"),premerge:new x("premerge",g.reserved,"premerge"),regardless:new x("regardless",g.reserved,"regardless"),typedef:new x("typedef",g.reserved,"typedef"),u8:new x("u8",g.reserved,"u8"),u16:new x("u16",g.reserved,"u16"),u64:new x("u64",g.reserved,"u64"),unless:new x("unless",g.reserved,"unless"),using:new x("using",g.reserved,"using"),vec:new x("vec",g.reserved,"vec"),void:new x("void",g.reserved,"void")};h.keywords={array:new x("array",g.keyword,"array"),atomic:new x("atomic",g.keyword,"atomic"),bool:new x("bool",g.keyword,"bool"),f32:new x("f32",g.keyword,"f32"),i32:new x("i32",g.keyword,"i32"),mat2x2:new x("mat2x2",g.keyword,"mat2x2"),mat2x3:new x("mat2x3",g.keyword,"mat2x3"),mat2x4:new x("mat2x4",g.keyword,"mat2x4"),mat3x2:new x("mat3x2",g.keyword,"mat3x2"),mat3x3:new x("mat3x3",g.keyword,"mat3x3"),mat3x4:new x("mat3x4",g.keyword,"mat3x4"),mat4x2:new x("mat4x2",g.keyword,"mat4x2"),mat4x3:new x("mat4x3",g.keyword,"mat4x3"),mat4x4:new x("mat4x4",g.keyword,"mat4x4"),ptr:new x("ptr",g.keyword,"ptr"),sampler:new x("sampler",g.keyword,"sampler"),sampler_comparison:new x("sampler_comparison",g.keyword,"sampler_comparison"),struct:new x("struct",g.keyword,"struct"),texture_1d:new x("texture_1d",g.keyword,"texture_1d"),texture_2d:new x("texture_2d",g.keyword,"texture_2d"),texture_2d_array:new x("texture_2d_array",g.keyword,"texture_2d_array"),texture_3d:new x("texture_3d",g.keyword,"texture_3d"),texture_cube:new x("texture_cube",g.keyword,"texture_cube"),texture_cube_array:new x("texture_cube_array",g.keyword,"texture_cube_array"),texture_multisampled_2d:new x("texture_multisampled_2d",g.keyword,"texture_multisampled_2d"),texture_storage_1d:new x("texture_storage_1d",g.keyword,"texture_storage_1d"),texture_storage_2d:new x("texture_storage_2d",g.keyword,"texture_storage_2d"),texture_storage_2d_array:new x("texture_storage_2d_array",g.keyword,"texture_storage_2d_array"),texture_storage_3d:new x("texture_storage_3d",g.keyword,"texture_storage_3d"),texture_depth_2d:new x("texture_depth_2d",g.keyword,"texture_depth_2d"),texture_depth_2d_array:new x("texture_depth_2d_array",g.keyword,"texture_depth_2d_array"),texture_depth_cube:new x("texture_depth_cube",g.keyword,"texture_depth_cube"),texture_depth_cube_array:new x("texture_depth_cube_array",g.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new x("texture_depth_multisampled_2d",g.keyword,"texture_depth_multisampled_2d"),texture_external:new x("texture_external",g.keyword,"texture_external"),u32:new x("u32",g.keyword,"u32"),vec2:new x("vec2",g.keyword,"vec2"),vec3:new x("vec3",g.keyword,"vec3"),vec4:new x("vec4",g.keyword,"vec4"),bitcast:new x("bitcast",g.keyword,"bitcast"),block:new x("block",g.keyword,"block"),break:new x("break",g.keyword,"break"),case:new x("case",g.keyword,"case"),continue:new x("continue",g.keyword,"continue"),continuing:new x("continuing",g.keyword,"continuing"),default:new x("default",g.keyword,"default"),diagnostic:new x("diagnostic",g.keyword,"diagnostic"),discard:new x("discard",g.keyword,"discard"),else:new x("else",g.keyword,"else"),enable:new x("enable",g.keyword,"enable"),fallthrough:new x("fallthrough",g.keyword,"fallthrough"),false:new x("false",g.keyword,"false"),fn:new x("fn",g.keyword,"fn"),for:new x("for",g.keyword,"for"),function:new x("function",g.keyword,"function"),if:new x("if",g.keyword,"if"),let:new x("let",g.keyword,"let"),const:new x("const",g.keyword,"const"),loop:new x("loop",g.keyword,"loop"),while:new x("while",g.keyword,"while"),private:new x("private",g.keyword,"private"),read:new x("read",g.keyword,"read"),read_write:new x("read_write",g.keyword,"read_write"),return:new x("return",g.keyword,"return"),requires:new x("requires",g.keyword,"requires"),storage:new x("storage",g.keyword,"storage"),switch:new x("switch",g.keyword,"switch"),true:new x("true",g.keyword,"true"),alias:new x("alias",g.keyword,"alias"),type:new x("type",g.keyword,"type"),uniform:new x("uniform",g.keyword,"uniform"),var:new x("var",g.keyword,"var"),override:new x("override",g.keyword,"override"),workgroup:new x("workgroup",g.keyword,"workgroup"),write:new x("write",g.keyword,"write"),r8unorm:new x("r8unorm",g.keyword,"r8unorm"),r8snorm:new x("r8snorm",g.keyword,"r8snorm"),r8uint:new x("r8uint",g.keyword,"r8uint"),r8sint:new x("r8sint",g.keyword,"r8sint"),r16uint:new x("r16uint",g.keyword,"r16uint"),r16sint:new x("r16sint",g.keyword,"r16sint"),r16float:new x("r16float",g.keyword,"r16float"),rg8unorm:new x("rg8unorm",g.keyword,"rg8unorm"),rg8snorm:new x("rg8snorm",g.keyword,"rg8snorm"),rg8uint:new x("rg8uint",g.keyword,"rg8uint"),rg8sint:new x("rg8sint",g.keyword,"rg8sint"),r32uint:new x("r32uint",g.keyword,"r32uint"),r32sint:new x("r32sint",g.keyword,"r32sint"),r32float:new x("r32float",g.keyword,"r32float"),rg16uint:new x("rg16uint",g.keyword,"rg16uint"),rg16sint:new x("rg16sint",g.keyword,"rg16sint"),rg16float:new x("rg16float",g.keyword,"rg16float"),rgba8unorm:new x("rgba8unorm",g.keyword,"rgba8unorm"),rgba8unorm_srgb:new x("rgba8unorm_srgb",g.keyword,"rgba8unorm_srgb"),rgba8snorm:new x("rgba8snorm",g.keyword,"rgba8snorm"),rgba8uint:new x("rgba8uint",g.keyword,"rgba8uint"),rgba8sint:new x("rgba8sint",g.keyword,"rgba8sint"),bgra8unorm:new x("bgra8unorm",g.keyword,"bgra8unorm"),bgra8unorm_srgb:new x("bgra8unorm_srgb",g.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new x("rgb10a2unorm",g.keyword,"rgb10a2unorm"),rg11b10float:new x("rg11b10float",g.keyword,"rg11b10float"),rg32uint:new x("rg32uint",g.keyword,"rg32uint"),rg32sint:new x("rg32sint",g.keyword,"rg32sint"),rg32float:new x("rg32float",g.keyword,"rg32float"),rgba16uint:new x("rgba16uint",g.keyword,"rgba16uint"),rgba16sint:new x("rgba16sint",g.keyword,"rgba16sint"),rgba16float:new x("rgba16float",g.keyword,"rgba16float"),rgba32uint:new x("rgba32uint",g.keyword,"rgba32uint"),rgba32sint:new x("rgba32sint",g.keyword,"rgba32sint"),rgba32float:new x("rgba32float",g.keyword,"rgba32float"),static_assert:new x("static_assert",g.keyword,"static_assert")};h.tokens={decimal_float_literal:new x("decimal_float_literal",g.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new x("hex_float_literal",g.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new x("int_literal",g.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new x("uint_literal",g.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new x("ident",g.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new x("and",g.token,"&"),and_and:new x("and_and",g.token,"&&"),arrow:new x("arrow ",g.token,"->"),attr:new x("attr",g.token,"@"),forward_slash:new x("forward_slash",g.token,"/"),bang:new x("bang",g.token,"!"),bracket_left:new x("bracket_left",g.token,"["),bracket_right:new x("bracket_right",g.token,"]"),brace_left:new x("brace_left",g.token,"{"),brace_right:new x("brace_right",g.token,"}"),colon:new x("colon",g.token,":"),comma:new x("comma",g.token,","),equal:new x("equal",g.token,"="),equal_equal:new x("equal_equal",g.token,"=="),not_equal:new x("not_equal",g.token,"!="),greater_than:new x("greater_than",g.token,">"),greater_than_equal:new x("greater_than_equal",g.token,">="),shift_right:new x("shift_right",g.token,">>"),less_than:new x("less_than",g.token,"<"),less_than_equal:new x("less_than_equal",g.token,"<="),shift_left:new x("shift_left",g.token,"<<"),modulo:new x("modulo",g.token,"%"),minus:new x("minus",g.token,"-"),minus_minus:new x("minus_minus",g.token,"--"),period:new x("period",g.token,"."),plus:new x("plus",g.token,"+"),plus_plus:new x("plus_plus",g.token,"++"),or:new x("or",g.token,"|"),or_or:new x("or_or",g.token,"||"),paren_left:new x("paren_left",g.token,"("),paren_right:new x("paren_right",g.token,")"),semicolon:new x("semicolon",g.token,";"),star:new x("star",g.token,"*"),tilde:new x("tilde",g.token,"~"),underscore:new x("underscore",g.token,"_"),xor:new x("xor",g.token,"^"),plus_equal:new x("plus_equal",g.token,"+="),minus_equal:new x("minus_equal",g.token,"-="),times_equal:new x("times_equal",g.token,"*="),division_equal:new x("division_equal",g.token,"/="),modulo_equal:new x("modulo_equal",g.token,"%="),and_equal:new x("and_equal",g.token,"&="),or_equal:new x("or_equal",g.token,"|="),xor_equal:new x("xor_equal",g.token,"^="),shift_right_equal:new x("shift_right_equal",g.token,">>="),shift_left_equal:new x("shift_left_equal",g.token,"<<=")};h.simpleTokens={"@":T.tokens.attr,"{":T.tokens.brace_left,"}":T.tokens.brace_right,":":T.tokens.colon,",":T.tokens.comma,"(":T.tokens.paren_left,")":T.tokens.paren_right,";":T.tokens.semicolon};h.literalTokens={"&":T.tokens.and,"&&":T.tokens.and_and,"->":T.tokens.arrow,"/":T.tokens.forward_slash,"!":T.tokens.bang,"[":T.tokens.bracket_left,"]":T.tokens.bracket_right,"=":T.tokens.equal,"==":T.tokens.equal_equal,"!=":T.tokens.not_equal,">":T.tokens.greater_than,">=":T.tokens.greater_than_equal,">>":T.tokens.shift_right,"<":T.tokens.less_than,"<=":T.tokens.less_than_equal,"<<":T.tokens.shift_left,"%":T.tokens.modulo,"-":T.tokens.minus,"--":T.tokens.minus_minus,".":T.tokens.period,"+":T.tokens.plus,"++":T.tokens.plus_plus,"|":T.tokens.or,"||":T.tokens.or_or,"*":T.tokens.star,"~":T.tokens.tilde,_:T.tokens.underscore,"^":T.tokens.xor,"+=":T.tokens.plus_equal,"-=":T.tokens.minus_equal,"*=":T.tokens.times_equal,"/=":T.tokens.division_equal,"%=":T.tokens.modulo_equal,"&=":T.tokens.and_equal,"|=":T.tokens.or_equal,"^=":T.tokens.xor_equal,">>=":T.tokens.shift_right_equal,"<<=":T.tokens.shift_left_equal};h.regexTokens={decimal_float_literal:T.tokens.decimal_float_literal,hex_float_literal:T.tokens.hex_float_literal,int_literal:T.tokens.int_literal,uint_literal:T.tokens.uint_literal,ident:T.tokens.ident};h.storage_class=[T.keywords.function,T.keywords.private,T.keywords.workgroup,T.keywords.uniform,T.keywords.storage];h.access_mode=[T.keywords.read,T.keywords.write,T.keywords.read_write];h.sampler_type=[T.keywords.sampler,T.keywords.sampler_comparison];h.sampled_texture_type=[T.keywords.texture_1d,T.keywords.texture_2d,T.keywords.texture_2d_array,T.keywords.texture_3d,T.keywords.texture_cube,T.keywords.texture_cube_array];h.multisampled_texture_type=[T.keywords.texture_multisampled_2d];h.storage_texture_type=[T.keywords.texture_storage_1d,T.keywords.texture_storage_2d,T.keywords.texture_storage_2d_array,T.keywords.texture_storage_3d];h.depth_texture_type=[T.keywords.texture_depth_2d,T.keywords.texture_depth_2d_array,T.keywords.texture_depth_cube,T.keywords.texture_depth_cube_array,T.keywords.texture_depth_multisampled_2d];h.texture_external_type=[T.keywords.texture_external];h.any_texture_type=[...T.sampled_texture_type,...T.multisampled_texture_type,...T.storage_texture_type,...T.depth_texture_type,...T.texture_external_type];h.texel_format=[T.keywords.r8unorm,T.keywords.r8snorm,T.keywords.r8uint,T.keywords.r8sint,T.keywords.r16uint,T.keywords.r16sint,T.keywords.r16float,T.keywords.rg8unorm,T.keywords.rg8snorm,T.keywords.rg8uint,T.keywords.rg8sint,T.keywords.r32uint,T.keywords.r32sint,T.keywords.r32float,T.keywords.rg16uint,T.keywords.rg16sint,T.keywords.rg16float,T.keywords.rgba8unorm,T.keywords.rgba8unorm_srgb,T.keywords.rgba8snorm,T.keywords.rgba8uint,T.keywords.rgba8sint,T.keywords.bgra8unorm,T.keywords.bgra8unorm_srgb,T.keywords.rgb10a2unorm,T.keywords.rg11b10float,T.keywords.rg32uint,T.keywords.rg32sint,T.keywords.rg32float,T.keywords.rgba16uint,T.keywords.rgba16sint,T.keywords.rgba16float,T.keywords.rgba32uint,T.keywords.rgba32sint,T.keywords.rgba32float];h.const_literal=[T.tokens.int_literal,T.tokens.uint_literal,T.tokens.decimal_float_literal,T.tokens.hex_float_literal,T.keywords.true,T.keywords.false];h.literal_or_ident=[T.tokens.ident,T.tokens.int_literal,T.tokens.uint_literal,T.tokens.decimal_float_literal,T.tokens.hex_float_literal];h.element_count_expression=[T.tokens.int_literal,T.tokens.uint_literal,T.tokens.ident];h.template_types=[T.keywords.vec2,T.keywords.vec3,T.keywords.vec4,T.keywords.mat2x2,T.keywords.mat2x3,T.keywords.mat2x4,T.keywords.mat3x2,T.keywords.mat3x3,T.keywords.mat3x4,T.keywords.mat4x2,T.keywords.mat4x3,T.keywords.mat4x4,T.keywords.atomic,T.keywords.bitcast,...T.any_texture_type];h.attribute_name=[T.tokens.ident,T.keywords.block,T.keywords.diagnostic];h.assignment_operators=[T.tokens.equal,T.tokens.plus_equal,T.tokens.minus_equal,T.tokens.times_equal,T.tokens.division_equal,T.tokens.modulo_equal,T.tokens.and_equal,T.tokens.or_equal,T.tokens.xor_equal,T.tokens.shift_right_equal,T.tokens.shift_left_equal];h.increment_operators=[T.tokens.plus_plus,T.tokens.minus_minus];class ar{constructor(t,e,r){this.type=t,this.lexeme=e,this.line=r}toString(){return this.lexeme}isTemplateType(){return h.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==h.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class Is{constructor(t){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=t??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new ar(h.eof,"",this._line)),this._tokens}scanToken(){let t=this._advance();if(t==`
`)return this._line++,!0;if(this._isWhitespace(t))return!0;if(t=="/"){if(this._peekAhead()=="/"){for(;t!=`
`;){if(this._isAtEnd())return!0;t=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let S=1;for(;S>0;){if(this._isAtEnd())return!0;if(t=this._advance(),t==`
`)this._line++;else if(t=="*"){if(this._peekAhead()=="/"&&(this._advance(),S--,S==0))return!0}else t=="/"&&this._peekAhead()=="*"&&(this._advance(),S++)}return!0}}const e=h.simpleTokens[t];if(e)return this._addToken(e),!0;let r=h.none;const o=this._isAlpha(t),f=t==="_";if(this._isAlphaNumeric(t)){let S=this._peekAhead();for(;this._isAlphaNumeric(S);)t+=this._advance(),S=this._peekAhead()}if(o){const S=h.keywords[t];if(S)return this._addToken(S),!0}if(o||f)return this._addToken(h.tokens.ident),!0;for(;;){let S=this._findType(t);const A=this._peekAhead();if(t=="-"&&this._tokens.length>0){if(A=="=")return this._current++,t+=A,this._addToken(h.tokens.minus_equal),!0;if(A=="-")return this._current++,t+=A,this._addToken(h.tokens.minus_minus),!0;const q=this._tokens.length-1;if((h.literal_or_ident.indexOf(this._tokens[q].type)!=-1||this._tokens[q].type==h.tokens.paren_right)&&A!=">")return this._addToken(S),!0}if(t==">"&&(A==">"||A=="=")){let q=!1,V=this._tokens.length-1;for(let Z=0;Z<5&&V>=0&&h.assignment_operators.indexOf(this._tokens[V].type)===-1;++Z,--V)if(this._tokens[V].type===h.tokens.less_than){V>0&&this._tokens[V-1].isArrayOrTemplateType()&&(q=!0);break}if(q)return this._addToken(S),!0}if(S===h.none){let q=t,V=0;const Z=2;for(let at=0;at<Z;++at)if(q+=this._peekAhead(at),S=this._findType(q),S!==h.none){V=at;break}if(S===h.none)return r===h.none?!1:(this._current--,this._addToken(r),!0);t=q,this._current+=V+1}if(r=S,this._isAtEnd())break;t+=this._advance()}return r===h.none?!1:(this._addToken(r),!0)}_findType(t){for(const r in h.regexTokens){const o=h.regexTokens[r];if(this._match(t,o.rule))return o}return h.literalTokens[t]||h.none}_match(t,e){const r=e.exec(t);return r&&r.index==0&&r[0]==t}_isAtEnd(){return this._current>=this._source.length}_isAlpha(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"}_isAlphaNumeric(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"||t=="_"||t>="0"&&t<="9"}_isWhitespace(t){return t==" "||t=="	"||t=="\r"}_advance(t=0){let e=this._source[this._current];return t=t||0,t++,this._current+=t,e}_peekAhead(t=0){return t=t||0,this._current+t>=this._source.length?"\0":this._source[this._current+t]}_addToken(t){const e=this._source.substring(this._start,this._current);this._tokens.push(new ar(t,e,this._line))}}class Ls{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new hs,this._deferArrayCountEval=[]}parse(t){this._initialize(t),this._deferArrayCountEval.length=0;const e=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;e.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const o=r.arrayType,f=r.countNode;if(f instanceof Nn){const S=f.name,A=this._context.constants.get(S);if(A)try{const q=A.evaluate(this._context);o.count=q}catch{}}}this._deferArrayCountEval.length=0}return e}_initialize(t){if(t)if(typeof t=="string"){const e=new Is(t);this._tokens=e.scanTokens()}else this._tokens=t;else this._tokens=[];this._current=0}_error(t,e){return{token:t,message:e,toString:function(){return`${e}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==h.eof}_match(t){if(t instanceof x)return this._check(t)?(this._advance(),!0):!1;for(let e=0,r=t.length;e<r;++e){const o=t[e];if(this._check(o))return this._advance(),!0}return!1}_consume(t,e){if(this._check(t))return this._advance();throw this._error(this._peek(),e)}_check(t){if(this._isAtEnd())return!1;const e=this._peek();if(t instanceof Array){const r=e.type;return t.indexOf(r)!=-1}return e.type==t}_advance(){var t,e;return this._currentLine=(e=(t=this._peek())===null||t===void 0?void 0:t.line)!==null&&e!==void 0?e:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(h.tokens.semicolon)&&!this._isAtEnd(););if(this._match(h.keywords.alias)){const e=this._type_alias();return this._consume(h.tokens.semicolon,"Expected ';'"),e}if(this._match(h.keywords.diagnostic)){const e=this._diagnostic();return this._consume(h.tokens.semicolon,"Expected ';'"),e}if(this._match(h.keywords.requires)){const e=this._requires_directive();return this._consume(h.tokens.semicolon,"Expected ';'"),e}if(this._match(h.keywords.enable)){const e=this._enable_directive();return this._consume(h.tokens.semicolon,"Expected ';'"),e}const t=this._attribute();if(this._check(h.keywords.var)){const e=this._global_variable_decl();return e!=null&&(e.attributes=t),this._consume(h.tokens.semicolon,"Expected ';'."),e}if(this._check(h.keywords.override)){const e=this._override_variable_decl();return e!=null&&(e.attributes=t),this._consume(h.tokens.semicolon,"Expected ';'."),e}if(this._check(h.keywords.let)){const e=this._global_let_decl();return e!=null&&(e.attributes=t),this._consume(h.tokens.semicolon,"Expected ';'."),e}if(this._check(h.keywords.const)){const e=this._global_const_decl();return e!=null&&(e.attributes=t),this._consume(h.tokens.semicolon,"Expected ';'."),e}if(this._check(h.keywords.struct)){const e=this._struct_decl();return e!=null&&(e.attributes=t),e}if(this._check(h.keywords.fn)){const e=this._function_decl();return e!=null&&(e.attributes=t),e}return null}_function_decl(){if(!this._match(h.keywords.fn))return null;const t=this._currentLine,e=this._consume(h.tokens.ident,"Expected function name.").toString();this._consume(h.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(h.tokens.paren_right))do{if(this._check(h.tokens.paren_right))break;const A=this._attribute(),q=this._consume(h.tokens.ident,"Expected argument name.").toString();this._consume(h.tokens.colon,"Expected ':' for argument type.");const V=this._attribute(),Z=this._type_decl();Z!=null&&(Z.attributes=V,r.push(new Rs(q,Z,A)))}while(this._match(h.tokens.comma));this._consume(h.tokens.paren_right,"Expected ')' after function arguments.");let o=null;if(this._match(h.tokens.arrow)){const A=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=A)}const f=this._compound_statement(),S=this._currentLine;return new Mn(e,r,o,f,t,S)}_compound_statement(){const t=[];for(this._consume(h.tokens.brace_left,"Expected '{' for block.");!this._check(h.tokens.brace_right);){const e=this._statement();e!==null&&t.push(e)}return this._consume(h.tokens.brace_right,"Expected '}' for block."),t}_statement(){for(;this._match(h.tokens.semicolon)&&!this._isAtEnd(););if(this._check(h.tokens.attr)&&this._attribute(),this._check(h.keywords.if))return this._if_statement();if(this._check(h.keywords.switch))return this._switch_statement();if(this._check(h.keywords.loop))return this._loop_statement();if(this._check(h.keywords.for))return this._for_statement();if(this._check(h.keywords.while))return this._while_statement();if(this._check(h.keywords.continuing))return this._continuing_statement();if(this._check(h.keywords.static_assert))return this._static_assert_statement();if(this._check(h.tokens.brace_left))return this._compound_statement();let t=null;return this._check(h.keywords.return)?t=this._return_statement():this._check([h.keywords.var,h.keywords.let,h.keywords.const])?t=this._variable_statement():this._match(h.keywords.discard)?t=new Es:this._match(h.keywords.break)?t=new Ts:this._match(h.keywords.continue)?t=new Ms:t=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),t!=null&&this._consume(h.tokens.semicolon,"Expected ';' after statement."),t}_static_assert_statement(){if(!this._match(h.keywords.static_assert))return null;const t=this._optional_paren_expression();return new ls(t)}_while_statement(){if(!this._match(h.keywords.while))return null;const t=this._optional_paren_expression();this._check(h.tokens.attr)&&this._attribute();const e=this._compound_statement();return new _s(t,e)}_continuing_statement(){if(!this._match(h.keywords.continuing))return null;const t=this._compound_statement();return new ds(t)}_for_statement(){if(!this._match(h.keywords.for))return null;this._consume(h.tokens.paren_left,"Expected '('.");const t=this._check(h.tokens.semicolon)?null:this._for_init();this._consume(h.tokens.semicolon,"Expected ';'.");const e=this._check(h.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(h.tokens.semicolon,"Expected ';'.");const r=this._check(h.tokens.paren_right)?null:this._for_increment();this._consume(h.tokens.paren_right,"Expected ')'."),this._check(h.tokens.attr)&&this._attribute();const o=this._compound_statement();return new ps(t,e,r,o)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(h.keywords.var)){const t=this._variable_decl();if(t===null)throw this._error(this._peek(),"Variable declaration expected.");let e=null;return this._match(h.tokens.equal)&&(e=this._short_circuit_or_expression()),new Te(t.name,t.type,t.storage,t.access,e)}if(this._match(h.keywords.let)){const t=this._consume(h.tokens.ident,"Expected name for let.").toString();let e=null;if(this._match(h.tokens.colon)){const o=this._attribute();e=this._type_decl(),e!=null&&(e.attributes=o)}this._consume(h.tokens.equal,"Expected '=' for let.");const r=this._short_circuit_or_expression();return new Sn(t,e,null,null,r)}if(this._match(h.keywords.const)){const t=this._consume(h.tokens.ident,"Expected name for const.").toString();let e=null;if(this._match(h.tokens.colon)){const o=this._attribute();e=this._type_decl(),e!=null&&(e.attributes=o)}this._consume(h.tokens.equal,"Expected '=' for const.");const r=this._short_circuit_or_expression();return new er(t,e,null,null,r)}return null}_increment_decrement_statement(){const t=this._current,e=this._unary_expression();if(e==null)return null;if(!this._check(h.increment_operators))return this._current=t,null;const r=this._consume(h.increment_operators,"Expected increment operator");return new fs(r.type===h.tokens.plus_plus?Ie.increment:Ie.decrement,e)}_assignment_statement(){let t=null;if(this._check(h.tokens.brace_right))return null;let e=this._match(h.tokens.underscore);if(e||(t=this._unary_expression()),!e&&t==null)return null;const r=this._consume(h.assignment_operators,"Expected assignment operator."),o=this._short_circuit_or_expression();return new ms(Ye.parse(r.lexeme),t,o)}_func_call_statement(){if(!this._check(h.tokens.ident))return null;const t=this._current,e=this._consume(h.tokens.ident,"Expected function name."),r=this._argument_expression_list();return r===null?(this._current=t,null):new vr(e.lexeme,r)}_loop_statement(){if(!this._match(h.keywords.loop))return null;this._check(h.tokens.attr)&&this._attribute(),this._consume(h.tokens.brace_left,"Expected '{' for loop.");const t=[];let e=this._statement();for(;e!==null;){if(Array.isArray(e))for(let o of e)t.push(o);else t.push(e);e=this._statement()}let r=null;return this._match(h.keywords.continuing)&&(r=this._compound_statement()),this._consume(h.tokens.brace_right,"Expected '}' for loop."),new ws(t,r)}_switch_statement(){if(!this._match(h.keywords.switch))return null;const t=this._optional_paren_expression();this._check(h.tokens.attr)&&this._attribute(),this._consume(h.tokens.brace_left,"Expected '{' for switch.");const e=this._switch_body();if(e==null||e.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(h.tokens.brace_right,"Expected '}' for switch."),new ys(t,e)}_switch_body(){const t=[];if(this._match(h.keywords.case)){const e=this._case_selectors();this._match(h.tokens.colon),this._check(h.tokens.attr)&&this._attribute(),this._consume(h.tokens.brace_left,"Exected '{' for switch case.");const r=this._case_body();this._consume(h.tokens.brace_right,"Exected '}' for switch case."),t.push(new Cs(e,r))}if(this._match(h.keywords.default)){this._match(h.tokens.colon),this._check(h.tokens.attr)&&this._attribute(),this._consume(h.tokens.brace_left,"Exected '{' for switch default.");const e=this._case_body();this._consume(h.tokens.brace_right,"Exected '}' for switch default."),t.push(new Us(e))}if(this._check([h.keywords.default,h.keywords.case])){const e=this._switch_body();t.push(e[0])}return t}_case_selectors(){const t=[this._shift_expression()];for(;this._match(h.tokens.comma);)t.push(this._shift_expression());return t}_case_body(){if(this._match(h.keywords.fallthrough))return this._consume(h.tokens.semicolon,"Expected ';'"),[];let t=this._statement();if(t==null)return[];t instanceof Array||(t=[t]);const e=this._case_body();return e.length==0?t:[...t,e[0]]}_if_statement(){if(!this._match(h.keywords.if))return null;const t=this._optional_paren_expression();this._check(h.tokens.attr)&&this._attribute();const e=this._compound_statement();let r=[];this._match_elseif()&&(this._check(h.tokens.attr)&&this._attribute(),r=this._elseif_statement(r));let o=null;return this._match(h.keywords.else)&&(this._check(h.tokens.attr)&&this._attribute(),o=this._compound_statement()),new gs(t,e,r,o)}_match_elseif(){return this._tokens[this._current].type===h.keywords.else&&this._tokens[this._current+1].type===h.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(t=[]){const e=this._optional_paren_expression(),r=this._compound_statement();return t.push(new Fs(e,r)),this._match_elseif()&&(this._check(h.tokens.attr)&&this._attribute(),this._elseif_statement(t)),t}_return_statement(){if(!this._match(h.keywords.return))return null;const t=this._short_circuit_or_expression();return new ks(t)}_short_circuit_or_expression(){let t=this._short_circuit_and_expr();for(;this._match(h.tokens.or_or);)t=new te(this._previous().toString(),t,this._short_circuit_and_expr());return t}_short_circuit_and_expr(){let t=this._inclusive_or_expression();for(;this._match(h.tokens.and_and);)t=new te(this._previous().toString(),t,this._inclusive_or_expression());return t}_inclusive_or_expression(){let t=this._exclusive_or_expression();for(;this._match(h.tokens.or);)t=new te(this._previous().toString(),t,this._exclusive_or_expression());return t}_exclusive_or_expression(){let t=this._and_expression();for(;this._match(h.tokens.xor);)t=new te(this._previous().toString(),t,this._and_expression());return t}_and_expression(){let t=this._equality_expression();for(;this._match(h.tokens.and);)t=new te(this._previous().toString(),t,this._equality_expression());return t}_equality_expression(){const t=this._relational_expression();return this._match([h.tokens.equal_equal,h.tokens.not_equal])?new te(this._previous().toString(),t,this._relational_expression()):t}_relational_expression(){let t=this._shift_expression();for(;this._match([h.tokens.less_than,h.tokens.greater_than,h.tokens.less_than_equal,h.tokens.greater_than_equal]);)t=new te(this._previous().toString(),t,this._shift_expression());return t}_shift_expression(){let t=this._additive_expression();for(;this._match([h.tokens.shift_left,h.tokens.shift_right]);)t=new te(this._previous().toString(),t,this._additive_expression());return t}_additive_expression(){let t=this._multiplicative_expression();for(;this._match([h.tokens.plus,h.tokens.minus]);)t=new te(this._previous().toString(),t,this._multiplicative_expression());return t}_multiplicative_expression(){let t=this._unary_expression();for(;this._match([h.tokens.star,h.tokens.forward_slash,h.tokens.modulo]);)t=new te(this._previous().toString(),t,this._unary_expression());return t}_unary_expression(){return this._match([h.tokens.minus,h.tokens.bang,h.tokens.tilde,h.tokens.star,h.tokens.and])?new Ds(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const t=this._primary_expression(),e=this._postfix_expression();return e&&(t.postfix=e),t}_postfix_expression(){if(this._match(h.tokens.bracket_left)){const t=this._short_circuit_or_expression();this._consume(h.tokens.bracket_right,"Expected ']'.");const e=new As(t),r=this._postfix_expression();return r&&(e.postfix=r),e}if(this._match(h.tokens.period)){const t=this._consume(h.tokens.ident,"Expected member name."),e=this._postfix_expression(),r=new nr(t.lexeme);return e&&(r.postfix=e),r}return null}_getStruct(t){return this._context.aliases.has(t)?this._context.aliases.get(t).type:this._context.structs.has(t)?this._context.structs.get(t):null}_primary_expression(){if(this._match(h.tokens.ident)){const r=this._previous().toString();if(this._check(h.tokens.paren_left)){const o=this._argument_expression_list(),f=this._getStruct(r);return f!=null?new Ue(f,o):new Mr(r,o)}if(this._context.constants.has(r)){const o=this._context.constants.get(r);return new rr(r,o.value)}return new Nn(r)}if(this._match(h.const_literal))return new sr(parseFloat(this._previous().toString()));if(this._check(h.tokens.paren_left))return this._paren_expression();if(this._match(h.keywords.bitcast)){this._consume(h.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(h.tokens.greater_than,"Expected '>'.");const o=this._paren_expression();return new Ns(r,o)}const t=this._type_decl(),e=this._argument_expression_list();return new Os(t,e)}_argument_expression_list(){if(!this._match(h.tokens.paren_left))return null;const t=[];do{if(this._check(h.tokens.paren_right))break;const e=this._short_circuit_or_expression();t.push(e)}while(this._match(h.tokens.comma));return this._consume(h.tokens.paren_right,"Expected ')' for agument list"),t}_optional_paren_expression(){this._match(h.tokens.paren_left);const t=this._short_circuit_or_expression();return this._match(h.tokens.paren_right),new ir([t])}_paren_expression(){this._consume(h.tokens.paren_left,"Expected '('.");const t=this._short_circuit_or_expression();return this._consume(h.tokens.paren_right,"Expected ')'."),new ir([t])}_struct_decl(){if(!this._match(h.keywords.struct))return null;const t=this._currentLine,e=this._consume(h.tokens.ident,"Expected name for struct.").toString();this._consume(h.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(h.tokens.brace_right);){const S=this._attribute(),A=this._consume(h.tokens.ident,"Expected variable name.").toString();this._consume(h.tokens.colon,"Expected ':' for struct member type.");const q=this._attribute(),V=this._type_decl();V!=null&&(V.attributes=q),this._check(h.tokens.brace_right)?this._match(h.tokens.comma):this._consume(h.tokens.comma,"Expected ',' for struct member."),r.push(new Ps(A,V,S))}this._consume(h.tokens.brace_right,"Expected '}' after struct body.");const o=this._currentLine,f=new we(e,r,t,o);return this._context.structs.set(e,f),f}_global_variable_decl(){const t=this._variable_decl();return t&&this._match(h.tokens.equal)&&(t.value=this._const_expression()),t}_override_variable_decl(){const t=this._override_decl();return t&&this._match(h.tokens.equal)&&(t.value=this._const_expression()),t}_global_const_decl(){if(!this._match(h.keywords.const))return null;const t=this._consume(h.tokens.ident,"Expected variable name");let e=null;if(this._match(h.tokens.colon)){const f=this._attribute();e=this._type_decl(),e!=null&&(e.attributes=f)}let r=null;if(this._match(h.tokens.equal)){const f=this._short_circuit_or_expression();if(f instanceof Ue)r=f;else if(f instanceof rr&&f.initializer instanceof Ue)r=f.initializer;else try{const S=f.evaluate(this._context);r=new sr(S)}catch{r=f}}const o=new er(t.toString(),e,"","",r);return this._context.constants.set(o.name,o),o}_global_let_decl(){if(!this._match(h.keywords.let))return null;const t=this._consume(h.tokens.ident,"Expected variable name");let e=null;if(this._match(h.tokens.colon)){const o=this._attribute();e=this._type_decl(),e!=null&&(e.attributes=o)}let r=null;return this._match(h.tokens.equal)&&(r=this._const_expression()),new Sn(t.toString(),e,"","",r)}_const_expression(){if(this._match(h.const_literal))return new nr(this._previous().toString());const t=this._type_decl();this._consume(h.tokens.paren_left,"Expected '('.");let e=[];for(;!this._check(h.tokens.paren_right)&&(e.push(this._const_expression()),!!this._check(h.tokens.comma));)this._advance();return this._consume(h.tokens.paren_right,"Expected ')'."),new Ue(t,e)}_variable_decl(){if(!this._match(h.keywords.var))return null;let t="",e="";this._match(h.tokens.less_than)&&(t=this._consume(h.storage_class,"Expected storage_class.").toString(),this._match(h.tokens.comma)&&(e=this._consume(h.access_mode,"Expected access_mode.").toString()),this._consume(h.tokens.greater_than,"Expected '>'."));const r=this._consume(h.tokens.ident,"Expected variable name");let o=null;if(this._match(h.tokens.colon)){const f=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=f)}return new Te(r.toString(),o,t,e,null)}_override_decl(){if(!this._match(h.keywords.override))return null;const t=this._consume(h.tokens.ident,"Expected variable name");let e=null;if(this._match(h.tokens.colon)){const r=this._attribute();e=this._type_decl(),e!=null&&(e.attributes=r)}return new xr(t.toString(),e,null)}_diagnostic(){this._consume(h.tokens.paren_left,"Expected '('");const t=this._consume(h.tokens.ident,"Expected severity control name.");this._consume(h.tokens.comma,"Expected ','");const e=this._consume(h.tokens.ident,"Expected diagnostic rule name.");return this._consume(h.tokens.paren_right,"Expected ')'"),new bs(t.toString(),e.toString())}_enable_directive(){const t=this._consume(h.tokens.ident,"identity expected.");return new xs(t.toString())}_requires_directive(){const t=[this._consume(h.tokens.ident,"identity expected.").toString()];for(;this._match(h.tokens.comma);){const e=this._consume(h.tokens.ident,"identity expected.");t.push(e.toString())}return new vs(t)}_type_alias(){const t=this._consume(h.tokens.ident,"identity expected.");this._consume(h.tokens.equal,"Expected '=' for type alias.");let e=this._type_decl();if(e===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(e.name)&&(e=this._context.aliases.get(e.name).type);const r=new br(t.toString(),e);return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([h.tokens.ident,...h.texel_format,h.keywords.bool,h.keywords.f32,h.keywords.i32,h.keywords.u32])){const r=this._advance(),o=r.toString();return this._context.structs.has(o)?this._context.structs.get(o):this._context.aliases.has(o)?this._context.aliases.get(o).type:new Oe(r.toString())}let t=this._texture_sampler_types();if(t)return t;if(this._check(h.template_types)){let r=this._advance().toString(),o=null,f=null;return this._match(h.tokens.less_than)&&(o=this._type_decl(),f=null,this._match(h.tokens.comma)&&(f=this._consume(h.access_mode,"Expected access_mode for pointer").toString()),this._consume(h.tokens.greater_than,"Expected '>' for type.")),new Er(r,o,f)}if(this._match(h.keywords.ptr)){let r=this._previous().toString();this._consume(h.tokens.less_than,"Expected '<' for pointer.");const o=this._consume(h.storage_class,"Expected storage_class for pointer");this._consume(h.tokens.comma,"Expected ',' for pointer.");const f=this._type_decl();let S=null;return this._match(h.tokens.comma)&&(S=this._consume(h.access_mode,"Expected access_mode for pointer").toString()),this._consume(h.tokens.greater_than,"Expected '>' for pointer."),new Ss(r,o.toString(),f,S)}const e=this._attribute();if(this._match(h.keywords.array)){let r=null,o=-1;const f=this._previous();let S=null;if(this._match(h.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let q="";if(this._match(h.tokens.comma)){S=this._shift_expression();try{q=S.evaluate(this._context).toString(),S=null}catch{q="1"}}this._consume(h.tokens.greater_than,"Expected '>' for array."),o=q?parseInt(q):0}const A=new Tr(f.toString(),e,r,o);return S&&this._deferArrayCountEval.push({arrayType:A,countNode:S}),A}return null}_texture_sampler_types(){if(this._match(h.sampler_type))return new ze(this._previous().toString(),null,null);if(this._match(h.depth_texture_type))return new ze(this._previous().toString(),null,null);if(this._match(h.sampled_texture_type)||this._match(h.multisampled_texture_type)){const t=this._previous();this._consume(h.tokens.less_than,"Expected '<' for sampler type.");const e=this._type_decl();return this._consume(h.tokens.greater_than,"Expected '>' for sampler type."),new ze(t.toString(),e,null)}if(this._match(h.storage_texture_type)){const t=this._previous();this._consume(h.tokens.less_than,"Expected '<' for sampler type.");const e=this._consume(h.texel_format,"Invalid texel format.").toString();this._consume(h.tokens.comma,"Expected ',' after texel format.");const r=this._consume(h.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(h.tokens.greater_than,"Expected '>' for sampler type."),new ze(t.toString(),e,r)}return null}_attribute(){let t=[];for(;this._match(h.tokens.attr);){const e=this._consume(h.attribute_name,"Expected attribute name"),r=new qs(e.toString(),null);if(this._match(h.tokens.paren_left)){if(r.value=this._consume(h.literal_or_ident,"Expected attribute value").toString(),this._check(h.tokens.comma)){this._advance();do{const o=this._consume(h.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(o)}while(this._match(h.tokens.comma))}this._consume(h.tokens.paren_right,"Expected ')'")}t.push(r)}return t.length==0?null:t}}class Pe{constructor(t,e){this.name=t,this.attributes=e,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class or{constructor(t,e,r){this.name=t,this.type=e,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class rn extends Pe{constructor(t,e){super(t,e),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Tn extends Pe{constructor(t,e){super(t,e),this.count=0,this.stride=0}get isArray(){return!0}}class ur extends Pe{constructor(t,e,r,o){super(t,r),this.format=e,this.access=o}get isTemplate(){return!0}}var me;(function(i){i[i.Uniform=0]="Uniform",i[i.Storage=1]="Storage",i[i.Texture=2]="Texture",i[i.Sampler=3]="Sampler",i[i.StorageTexture=4]="StorageTexture"})(me||(me={}));class sn{constructor(t,e,r,o,f,S,A){this.name=t,this.type=e,this.group=r,this.binding=o,this.attributes=f,this.resourceType=S,this.access=A}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class zs{constructor(t,e){this.name=t,this.type=e}}class an{constructor(t,e){this.align=t,this.size=e}}class Gs{constructor(t,e,r,o){this.name=t,this.type=e,this.locationType=r,this.location=o,this.interpolation=null}}class cr{constructor(t,e,r,o){this.name=t,this.type=e,this.locationType=r,this.location=o}}class Vs{constructor(t,e=null){this.stage=null,this.inputs=[],this.outputs=[],this.resources=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=t,this.stage=e}}class Bs{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class Ws{constructor(t,e,r,o){this.name=t,this.type=e,this.attributes=r,this.id=o}}class Xs{constructor(t){this.resources=null,this.inUse=!1,this.info=null,this.node=t}}class ue{constructor(t){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new Bs,this.functions=[],this._types=new Map,this._functions=new Map,t&&this.update(t)}_isStorageTexture(t){return t.name=="texture_storage_1d"||t.name=="texture_storage_2d"||t.name=="texture_storage_2d_array"||t.name=="texture_storage_3d"}update(t){const e=new Ls().parse(t);for(const r of e)r instanceof Mn&&this._functions.set(r.name,new Xs(r));for(const r of e)if(r instanceof we){const o=this._getTypeInfo(r,null);o instanceof rn&&this.structs.push(o)}for(const r of e){if(r instanceof br){this.aliases.push(this._getAliasInfo(r));continue}if(r instanceof xr){const o=r,f=this._getAttributeNum(o.attributes,"id",0),S=o.type!=null?this._getTypeInfo(o.type,o.attributes):null;this.overrides.push(new Ws(o.name,S,o.attributes,f));continue}if(this._isUniformVar(r)){const o=r,f=this._getAttributeNum(o.attributes,"group",0),S=this._getAttributeNum(o.attributes,"binding",0),A=this._getTypeInfo(o.type,o.attributes),q=new sn(o.name,A,f,S,o.attributes,me.Uniform,o.access);this.uniforms.push(q);continue}if(this._isStorageVar(r)){const o=r,f=this._getAttributeNum(o.attributes,"group",0),S=this._getAttributeNum(o.attributes,"binding",0),A=this._getTypeInfo(o.type,o.attributes),q=this._isStorageTexture(A),V=new sn(o.name,A,f,S,o.attributes,q?me.StorageTexture:me.Storage,o.access);this.storage.push(V);continue}if(this._isTextureVar(r)){const o=r,f=this._getAttributeNum(o.attributes,"group",0),S=this._getAttributeNum(o.attributes,"binding",0),A=this._getTypeInfo(o.type,o.attributes),q=this._isStorageTexture(A),V=new sn(o.name,A,f,S,o.attributes,q?me.StorageTexture:me.Texture,o.access);q?this.storage.push(V):this.textures.push(V);continue}if(this._isSamplerVar(r)){const o=r,f=this._getAttributeNum(o.attributes,"group",0),S=this._getAttributeNum(o.attributes,"binding",0),A=this._getTypeInfo(o.type,o.attributes),q=new sn(o.name,A,f,S,o.attributes,me.Sampler,o.access);this.samplers.push(q);continue}if(r instanceof Mn){const o=this._getAttribute(r,"vertex"),f=this._getAttribute(r,"fragment"),S=this._getAttribute(r,"compute"),A=o||f||S,q=new Vs(r.name,A?.name);q.startLine=r.startLine,q.endLine=r.endLine,this.functions.push(q),this._functions.get(r.name).info=q,A&&(this._functions.get(r.name).inUse=!0,q.inUse=!0,q.resources=this._findResources(r,!!A),q.inputs=this._getInputs(r.args),q.outputs=this._getOutputs(r.returnType),this.entry[A.name].push(q));continue}}for(const r of this._functions.values())r.info&&(r.info.inUse=r.inUse,this._addCalls(r.node,r.info.calls));for(const r of this.uniforms)this._markStructsInUse(r.type);for(const r of this.storage)this._markStructsInUse(r.type)}_markStructsInUse(t){if(t.isStruct){t.inUse=!0;for(const e of t.members)this._markStructsInUse(e.type)}else if(t.isArray)this._markStructsInUse(t.format);else if(t.isTemplate)this._markStructsInUse(t.format);else{const e=this._getAlias(t.name);e&&this._markStructsInUse(e)}}_addCalls(t,e){var r;for(const o of t.calls){const f=(r=this._functions.get(o.name))===null||r===void 0?void 0:r.info;f&&e.add(f)}}findResource(t,e){for(const r of this.uniforms)if(r.group==t&&r.binding==e)return r;for(const r of this.storage)if(r.group==t&&r.binding==e)return r;for(const r of this.textures)if(r.group==t&&r.binding==e)return r;for(const r of this.samplers)if(r.group==t&&r.binding==e)return r;return null}_findResource(t){for(const e of this.uniforms)if(e.name==t)return e;for(const e of this.storage)if(e.name==t)return e;for(const e of this.textures)if(e.name==t)return e;for(const e of this.samplers)if(e.name==t)return e;return null}_markStructsFromAST(t){const e=this._getTypeInfo(t,null);this._markStructsInUse(e)}_findResources(t,e){const r=[],o=this,f=[];return t.search(S=>{if(S instanceof kn)f.push({});else if(S instanceof xn)f.pop();else if(S instanceof Te){const A=S;e&&A.type!==null&&this._markStructsFromAST(A.type),f.length>0&&(f[f.length-1][A.name]=A)}else if(S instanceof Ue){const A=S;e&&A.type!==null&&this._markStructsFromAST(A.type)}else if(S instanceof Sn){const A=S;e&&A.type!==null&&this._markStructsFromAST(A.type),f.length>0&&(f[f.length-1][A.name]=A)}else if(S instanceof Nn){const A=S;if(f.length>0&&f[f.length-1][A.name])return;const q=o._findResource(A.name);q&&r.push(q)}else if(S instanceof Mr){const A=S,q=o._functions.get(A.name);q&&(e&&(q.inUse=!0),t.calls.add(q.node),q.resources===null&&(q.resources=o._findResources(q.node,e)),r.push(...q.resources))}else if(S instanceof vr){const A=S,q=o._functions.get(A.name);q&&(e&&(q.inUse=!0),t.calls.add(q.node),q.resources===null&&(q.resources=o._findResources(q.node,e)),r.push(...q.resources))}}),[...new Map(r.map(S=>[S.name,S])).values()]}getBindGroups(){const t=[];function e(r,o){r>=t.length&&(t.length=r+1),t[r]===void 0&&(t[r]=[]),o>=t[r].length&&(t[r].length=o+1)}for(const r of this.uniforms){e(r.group,r.binding);const o=t[r.group];o[r.binding]=r}for(const r of this.storage){e(r.group,r.binding);const o=t[r.group];o[r.binding]=r}for(const r of this.textures){e(r.group,r.binding);const o=t[r.group];o[r.binding]=r}for(const r of this.samplers){e(r.group,r.binding);const o=t[r.group];o[r.binding]=r}return t}_getOutputs(t,e=void 0){if(e===void 0&&(e=[]),t instanceof we)this._getStructOutputs(t,e);else{const r=this._getOutputInfo(t);r!==null&&e.push(r)}return e}_getStructOutputs(t,e){for(const r of t.members)if(r.type instanceof we)this._getStructOutputs(r.type,e);else{const o=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(o!==null){const f=this._getTypeInfo(r.type,r.type.attributes),S=this._parseInt(o.value),A=new cr(r.name,f,o.name,S);e.push(A)}}}_getOutputInfo(t){const e=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(e!==null){const r=this._getTypeInfo(t,t.attributes),o=this._parseInt(e.value);return new cr("",r,e.name,o)}return null}_getInputs(t,e=void 0){e===void 0&&(e=[]);for(const r of t)if(r.type instanceof we)this._getStructInputs(r.type,e);else{const o=this._getInputInfo(r);o!==null&&e.push(o)}return e}_getStructInputs(t,e){for(const r of t.members)if(r.type instanceof we)this._getStructInputs(r.type,e);else{const o=this._getInputInfo(r);o!==null&&e.push(o)}}_getInputInfo(t){const e=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(e!==null){const r=this._getAttribute(t,"interpolation"),o=this._getTypeInfo(t.type,t.attributes),f=this._parseInt(e.value),S=new Gs(t.name,o,e.name,f);return r!==null&&(S.interpolation=this._parseString(r.value)),S}return null}_parseString(t){return t instanceof Array&&(t=t[0]),t}_parseInt(t){t instanceof Array&&(t=t[0]);const e=parseInt(t);return isNaN(e)?t:e}_getAlias(t){for(const e of this.aliases)if(e.name==t)return e.type;return null}_getAliasInfo(t){return new zs(t.name,this._getTypeInfo(t.type,null))}_getTypeInfo(t,e){if(this._types.has(t))return this._types.get(t);if(t instanceof Tr){const o=t,f=this._getTypeInfo(o.format,o.attributes),S=new Tn(o.name,e);return S.format=f,S.count=o.count,this._types.set(t,S),this._updateTypeInfo(S),S}if(t instanceof we){const o=t,f=new rn(o.name,e);f.startLine=o.startLine,f.endLine=o.endLine;for(const S of o.members){const A=this._getTypeInfo(S.type,S.attributes);f.members.push(new or(S.name,A,S.attributes))}return this._types.set(t,f),this._updateTypeInfo(f),f}if(t instanceof ze){const o=t,f=o.format instanceof Oe,S=o.format?f?this._getTypeInfo(o.format,null):new Pe(o.format,null):null,A=new ur(o.name,S,e,o.access);return this._types.set(t,A),this._updateTypeInfo(A),A}if(t instanceof Er){const o=t,f=o.format?this._getTypeInfo(o.format,null):null,S=new ur(o.name,f,e,o.access);return this._types.set(t,S),this._updateTypeInfo(S),S}const r=new Pe(t.name,e);return this._types.set(t,r),this._updateTypeInfo(r),r}_updateTypeInfo(t){var e,r;const o=this._getTypeSize(t);if(t.size=(e=o?.size)!==null&&e!==void 0?e:0,t instanceof Tn){const f=this._getTypeSize(t.format);t.stride=(r=f?.size)!==null&&r!==void 0?r:0,this._updateTypeInfo(t.format)}t instanceof rn&&this._updateStructInfo(t)}_updateStructInfo(t){var e;let r=0,o=0,f=0,S=0;for(let A=0,q=t.members.length;A<q;++A){const V=t.members[A],Z=this._getTypeSize(V);if(!Z)continue;(e=this._getAlias(V.type.name))!==null&&e!==void 0||V.type;const at=Z.align,wt=Z.size;r=this._roundUp(at,r+o),o=wt,f=r,S=Math.max(S,at),V.offset=r,V.size=wt,this._updateTypeInfo(V.type)}t.size=this._roundUp(S,f+o),t.align=S}_getTypeSize(t){var e;if(t==null)return null;const r=this._getAttributeNum(t.attributes,"size",0),o=this._getAttributeNum(t.attributes,"align",0);if(t instanceof or&&(t=t.type),t instanceof Pe){const f=this._getAlias(t.name);f!==null&&(t=f)}{const f=ue._typeInfo[t.name];if(f!==void 0){const S=t.format==="f16"?2:1;return new an(Math.max(o,f.align/S),Math.max(r,f.size/S))}}{const f=ue._typeInfo[t.name.substring(0,t.name.length-1)];if(f){const S=t.name[t.name.length-1]==="h"?2:1;return new an(Math.max(o,f.align/S),Math.max(r,f.size/S))}}if(t instanceof Tn){let f=t,S=8,A=8;const q=this._getTypeSize(f.format);q!==null&&(A=q.size,S=q.align);const V=f.count,Z=this._getAttributeNum((e=t?.attributes)!==null&&e!==void 0?e:null,"stride",this._roundUp(S,A));return A=V*Z,r&&(A=r),new an(Math.max(o,S),Math.max(r,A))}if(t instanceof rn){let f=0,S=0,A=0,q=0,V=0;for(const Z of t.members){const at=this._getTypeSize(Z.type);at!==null&&(f=Math.max(at.align,f),A=this._roundUp(at.align,A+q),q=at.size,V=A)}return S=this._roundUp(f,V+q),new an(Math.max(o,f),Math.max(r,S))}return null}_isUniformVar(t){return t instanceof Te&&t.storage=="uniform"}_isStorageVar(t){return t instanceof Te&&t.storage=="storage"}_isTextureVar(t){return t instanceof Te&&t.type!==null&&ue._textureTypes.indexOf(t.type.name)!=-1}_isSamplerVar(t){return t instanceof Te&&t.type!==null&&ue._samplerTypes.indexOf(t.type.name)!=-1}_getAttribute(t,e){const r=t;if(!r||!r.attributes)return null;const o=r.attributes;for(let f of o)if(f.name==e)return f;return null}_getAttributeNum(t,e,r){if(t===null)return r;for(let o of t)if(o.name==e){let f=o!==null&&o.value!==null?o.value:r;return f instanceof Array&&(f=f[0]),typeof f=="number"?f:typeof f=="string"?parseInt(f):r}return r}_roundUp(t,e){return Math.ceil(e/t)*t}}ue._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};ue._textureTypes=h.any_texture_type.map(i=>i.name);ue._samplerTypes=h.sampler_type.map(i=>i.name);var Or="@vertex fn vertex()->@builtin(position)vec4f {return vec4f(0);}@fragment fn fragment()->@location(0)vec4f {return vec4f(0);}@compute @workgroup_size(1)fn compute(){}",Ge,Ce,ye,ge,hn,ln,_n,Re,Fe,vn,Ar;class Dr{constructor(t,e,r){$(this,Fe),$(this,Ge),$(this,Ce),$(this,ye),De(this,"Device"),De(this,"BindGroups",[]),De(this,"Reflect"),$(this,ge),De(this,"Pipeline"),De(this,"Descriptor"),$(this,hn),$(this,ln),$(this,_n),$(this,Re,[]),!t&&lt(ot.DEVICE_NOT_REQUESTED),L(this,Ge,r),this.Device=t,L(this,Ce,e),L(this,ye,this.CreatePipelineLabel("Command Encoder"))}CreatePipelineLabel(t){return M(this,Ce)&&t&&`${M(this,Ce)} ${t}`||""}CreatePipelineLayout(t,e){e??(e=this.CreatePipelineLabel(`${M(this,Ge)} Pipeline Layout`));const r=Array.isArray(t)&&t||[t];return this.Device.createPipelineLayout({label:e,bindGroupLayouts:r})}CreateShaderModule(t,e,r,o){t||(t=Or,Me(ot.SHADER_CODE_NOT_FOUND)),e??(e=this.CreatePipelineLabel("Shader Module"));const f=Array.isArray(t)&&t.join(`

`)||t;return this.Reflect=new ue(f),this.Device.createShaderModule({label:e,code:f,sourceMap:r,compilationHints:o})}GetShaderModule(t){return t instanceof GPUShaderModule&&t||t.module}CreateUniformBufferLayout(t){!this.Reflect&&lt(ot.SHADER_MODULE_NOT_FOUND,"`CreateUniformBufferLayout`.\n            Use `CreateShaderModule` before creating a uniform buffer layout.");const e=this.Reflect.uniforms.find(({name:r})=>t===r);return!e&&lt(ot.UNIFORM_NOT_FOUND,`\`${t}\` in shader uniforms.`),t==="resolution"&&Me(ot.INVALID_UNIFORM_NAME,`\`${t}\`.`),ft(this,Fe,vn).call(this,e,new ArrayBuffer(e.size))}CreateBuffer(t){const e=t.label??this.CreatePipelineLabel("Buffer");return this.Device.createBuffer({...t,label:e})}CreateUniformBuffer(t,e){!this.Reflect&&lt(ot.SHADER_MODULE_NOT_FOUND,"`CreateUniformBuffer`.\n            Use `CreateShaderModule` before creating a uniform buffer.");const r=this.Reflect.uniforms.find(({name:S})=>t===S);!r&&lt(ot.UNIFORM_NOT_FOUND,`\`${t}\` in shader uniforms.`),t==="resolution"&&Me(ot.INVALID_UNIFORM_NAME,`\`${t}\`.`);const o=e?.label??`${t} Uniform Buffer`,f=new ArrayBuffer(r.size);return{buffer:this.CreateBuffer({size:f.byteLength,usage:cs.UNIFORM,label:o,...e}),[t]:ft(this,Fe,vn).call(this,r,f)}}WriteBuffer(t,e,r=0,o,f){this.Device.queue.writeBuffer(t,r,e,o,f)}CopyBufferToBuffer(t,e,r,o=0,f=0){this.GetCommandEncoder(!0).copyBufferToBuffer(t,o,e,f,r)}CreateBindGroupLayout(t,e){e??(e=this.CreatePipelineLabel("Bind Group Layout")),t=Array.isArray(t)&&t.map((o,f)=>({...o,binding:o.binding??f}))||[{...t,binding:t.binding??0}];const r=t;return this.Device.createBindGroupLayout({entries:r,label:e})}CreateBindGroupEntries(t,e=0){return Array.isArray(t)&&t.map((r,o)=>({binding:e?.[o]??o,resource:r}))||[{binding:e,resource:t}]}CreateBindGroup(t,e=0,r){return r??(r=this.CreatePipelineLabel("Bind Group")),typeof e=="number"&&(e=this.Pipeline?this.Pipeline.getBindGroupLayout(e):lt(ot.PIPELINE_NOT_FOUND,`${M(this,Ge)}Pipeline.`)),this.Device.createBindGroup({entries:t,label:r,layout:e})}SetBindGroups(t,e){Array.isArray(e)?e[0].length||(e=e.map(r=>[r])):e=[e],this.BindGroups=Array.isArray(t)&&t.map((r,o)=>({bindGroup:r,dynamicOffsets:e[o],active:!0}))||[{bindGroup:t,dynamicOffsets:e[0],active:!0}]}AddBindGroups(t,e){return Array.isArray(e)?e[0].length||(e=e.map(r=>[r])):e=[e],this.BindGroups.push(...Array.isArray(t)&&t.map((r,o)=>({bindGroup:r,dynamicOffsets:e[o],active:!0}))||[{bindGroup:t,dynamicOffsets:e[0],active:!0}])}SetActiveBindGroups(t){t=Array.isArray(t)&&t||[t];for(let e=this.BindGroups.length;e--;)this.BindGroups[e].active=t.includes(e)}ClearBindGroups(){this.BindGroups.splice(0)}CreateCommandEncoder(){return L(this,ge,this.Device.createCommandEncoder({label:M(this,ye)}))}SetCommandEncoder(t){L(this,ge,t)}GetCommandEncoder(t=!1){if(!M(this,ge)){if(t){const e=`${M(this,ye)&&`Label: "${M(this,ye)}".`}`;Me(ot.COMMAND_ENCODER_NOT_FOUND,` ${e} Creating a new one.`)}return this.CreateCommandEncoder()}return M(this,ge)}SubmitCommandBuffer(){this.Device.queue.submit([M(this,ge).finish()])}SavePipelineState(){L(this,_n,this.Reflect),L(this,ln,this.Pipeline),L(this,hn,this.Descriptor),L(this,Re,[...this.BindGroups])}ResetPipelineState(){this.ClearBindGroups()}RestorePipelineState(){this.Descriptor=M(this,hn),this.Pipeline=M(this,ln),this.Reflect=M(this,_n),ft(this,Fe,Ar).call(this)}set CommandEncoderLabel(t){L(this,ye,t)}get ProgramName(){return M(this,Ce)}}Ge=new WeakMap,Ce=new WeakMap,ye=new WeakMap,ge=new WeakMap,hn=new WeakMap,ln=new WeakMap,_n=new WeakMap,Re=new WeakMap,Fe=new WeakSet,vn=function(i,t,e=0,r=[]){const{format:o}=i.type,f=i.type.members??o?.members;let S=e+(i.offset??0);if(f)for(let A=0,q={},V=o?.isStruct&&i.count||1;A<V;++A)f.forEach(Z=>q[Z.name]=ft(this,Fe,vn).call(this,Z,t,S)),o!=null&&o.isStruct&&(S+=i.stride),r.push(q);else{const A=as((o??i.type).name),q=i.size/os(A),V=us(A);return new V(t,S,q)}return r.length===1&&r[0]||r},Ar=function(){const i=M(this,Re).map(({bindGroup:o})=>o),t=M(this,Re).map(({dynamicOffsets:o})=>o),e=t.some(o=>typeof o=="number")&&t||void 0,r=M(this,Re).map(({active:o},f)=>o&&f).filter(o=>typeof o=="number");this.SetBindGroups(i,e),this.SetActiveBindGroups(r)};const Cr=pt({RENDER:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST}),Hs=pt({ALL:"all",STENCIL:"stencil-only",DEPTH:"depth-only"}),Qs=pt({CLAMP:"clamp-to-edge",REPEAT:"repeat",MIRROR:"mirror-repeat"}),On=pt({NEAREST:"nearest",LINEAR:"linear"}),$s=pt({NEVER:"never",LESS:"less",EQUAL:"equal",LESS_EQUAL:"less-equal",GREATER:"greater",NOT_EQUAL:"not-equal",GREATER_EQUAL:"greater-equal",ALWAYS:"always"}),Ys=Object.freeze(Object.defineProperty({__proto__:null,ADDRESS:Qs,ASPECT:Hs,COMPARE:$s,FILTER:On,USAGE:Cr},Symbol.toStringTag,{value:"Module"}));var Ur="struct Shape{color: vec4f,matrix: mat3x3f};@group(0)@binding(0)var<uniform>resolution: vec2f;fn GetClipSpace(position: vec2f)->vec2f{let clipSpace=position/resolution*2-1;return clipSpace*vec2f(1,-1);}@group(0)@binding(1)var<uniform>shape: Shape;fn GetVertexClipSpace(position: vec2f)->vec4f{let matrixPosition=shape.matrix*vec3f(position,1);let clipSpace=GetClipSpace(matrixPosition.xy);return vec4f(clipSpace,0.0,1.0);}@vertex fn vertex(@location(0)position: vec2f)->@builtin(position)vec4f {return GetVertexClipSpace(position);}",Rr="@fragment fn fragment()->@location(0)vec4f {return shape.color;}",Fr="const QUAD=array(vec2f(-1.0,-1.0),vec2f(1.0,-1.0),vec2f(1.0,1.0),vec2f(1.0,1.0),vec2f(-1.0,1.0),vec2f(-1.0,-1.0));fn GetQuadCoord(index: u32)->vec2f{return QUAD[index];}struct VertexOutput{@builtin(position)position: vec4f,@location(0)textureCoord: vec2f};@group(0)@binding(0)var Sampler: sampler;@group(0)@binding(1)var Texture: texture_2d<f32>;@vertex fn vertex(@builtin(vertex_index)index: u32)->VertexOutput {let position=GetQuadCoord(index);let coord=(position+1)*0.5;var output: VertexOutput;output.position=vec4f(position,0.0,1.0);output.textureCoord=vec2f(coord.x,1-coord.y);return output;}@fragment fn fragment(@location(0)textureCoord: vec2f)->@location(0)vec4f {return textureSample(Texture,Sampler,textureCoord);}",Zs="const QUAD=array(vec2f(-1.0,-1.0),vec2f(1.0,-1.0),vec2f(1.0,1.0),vec2f(1.0,1.0),vec2f(-1.0,1.0),vec2f(-1.0,-1.0));fn GetQuadCoord(index: u32)->vec2f{return QUAD[index];}",js="@group(0)@binding(0)var<uniform>resolution: vec2f;fn GetClipSpace(position: vec2f)->vec2f{let clipSpace=position/resolution*2-1;return clipSpace*vec2f(1,-1);}";const Js=`${Ur}

${Rr}`,hr=Object.freeze(Object.defineProperty({__proto__:null,Empty:Or,Mipmaps:Fr,Quad:Zs,Resolution:js,Shape:Js,ShapeFragmen:Rr,ShapeVertex:Ur},Symbol.toStringTag,{value:"Module"}));var ne,de,ut,Se,ke,re,dn,An,Dn;class Pr{constructor(t,e){$(this,re),$(this,ne),$(this,de),$(this,ut),$(this,Se),$(this,ke),!t&&lt(ot.DEVICE_NOT_REQUESTED),this.Renderer=e,L(this,ne,t)}CreateTexture(t){const e=t.label??"Texture";return M(this,ne).createTexture({...t,label:e})}WriteTexture(t,e){const{texture:r,mipLevel:o,origin:f,aspect:S,offset:A,bytesPerRow:q,rowsPerImage:V}=e;M(this,ne).queue.writeTexture({texture:r,mipLevel:o,origin:f,aspect:S},t,{offset:A,bytesPerRow:q,rowsPerImage:V},ft(this,re,An).call(this,e,"WriteTexture"))}CreateBitmapImage(t,e){return createImageBitmap(t,e)}CreateTextureFromSource(t,e={}){e=typeof e=="boolean"&&{}||e;const{mipmaps:r=!0,size:o,format:f="rgba8unorm",usage:S=Cr.RENDER}=e,A=e.mipLevelCount??(r&&this.GetMipmapLevels(t)||void 0),q=o,V=o,Z=Array.isArray(o)||!o?q??ft(this,re,dn).call(this,t):[V.width,V.height];return this.CreateTexture({size:Z,mipLevelCount:A,format:f,usage:S,...e})}ImportExternalTexture(t,e,r){return M(this,ne).importExternalTexture({source:t,label:e,colorSpace:r})}CreateMultisampleTexture(t=!1,e=4,r){var o;!M(this,ut)&&lt(ot.RENDER_PIPELNE_NOT_FOUND,"multisample texture.");const{width:f,height:S,format:A}=M(this,ut).CurrentTexture;return(t||!M(this,de)||M(this,de).width!==f||M(this,de).height!==S)&&((o=M(this,de))==null||o.destroy(),L(this,de,this.CreateTexture({usage:GPUTextureUsage.RENDER_ATTACHMENT,label:r??"Multisample Texture",size:[f,S],sampleCount:e,format:A}))),M(this,de)}CopyImageToTexture(t,e={create:!0}){let{texture:r}=e;const[o,f]=ft(this,re,dn).call(this,t),{create:S,flipY:A,mipLevel:q,aspect:V,colorSpace:Z,premultipliedAlpha:at,generateMipmaps:wt}=e;return!r&&!S&&lt(ot.TEXTURE_NOT_FOUND),r??(r=this.CreateTextureFromSource(t,S)),M(this,ne).queue.copyExternalImageToTexture({source:t,origin:e.sourceOrigin,flipY:A},{texture:r,mipLevel:q,origin:e.destinationOrigin,aspect:V,colorSpace:Z,premultipliedAlpha:at},ft(this,re,An).call(this,{width:o,height:f,...e},"CopyImageToTexture")),(wt??!0)&&1<r.mipLevelCount&&(r.depthOrArrayLayers===1?this.GenerateMipmaps(r):this.GenerateCubeMipmaps(r)),r}GenerateCubeMipmaps(t){ft(this,re,Dn).call(this,t,{minMagFilter:On.LINEAR},e=>{for(let r=0;r<t.depthOrArrayLayers;++r)M(this,ut).SetBindGroups(M(this,ut).CreateBindGroup(M(this,ut).CreateBindGroupEntries([M(this,Se),t.createView({arrayLayerCount:1,baseArrayLayer:r,mipLevelCount:1,dimension:"2d",baseMipLevel:e})]))),M(this,ut).CreatePassDescriptor(M(this,ut).CreateColorAttachment(t.createView({baseMipLevel:e+1,arrayLayerCount:1,baseArrayLayer:r,mipLevelCount:1,dimension:"2d"}))),M(this,ut).Render(6,!1),M(this,ut).DestroyCurrentPass()})}GenerateMipmaps(t){ft(this,re,Dn).call(this,t,{minFilter:On.LINEAR},e=>{M(this,ut).SetBindGroups(M(this,ut).CreateBindGroup(M(this,ut).CreateBindGroupEntries([M(this,Se),t.createView({baseMipLevel:e++,mipLevelCount:1})]))),M(this,ut).CreatePassDescriptor(M(this,ut).CreateColorAttachment(t.createView({baseMipLevel:e,mipLevelCount:1}))),M(this,ut).Render(6,!1),M(this,ut).DestroyCurrentPass()})}CreateSampler(t){if(!t)return M(this,ne).createSampler();const{addressModeUV:e,addressMode:r,minMagFilter:o,filter:f}=t;return e&&(t.addressModeU=t.addressModeV=e),r&&(t.addressModeU=t.addressModeV=t.addressModeW=r),o&&(t.minFilter=t.magFilter=o),f&&(t.minFilter=t.magFilter=t.mipmapFilter=f),M(this,ne).createSampler(t)}GetMipmapLevels(t){const[e,r]=ft(this,re,dn).call(this,t);return(Math.log2(Math.max(e,r))|0)+1}set Renderer(t){L(this,ut,t)}SetRenderer(t){this.Renderer=t}}ne=new WeakMap,de=new WeakMap,ut=new WeakMap,Se=new WeakMap,ke=new WeakMap,re=new WeakSet,dn=function(i){return i instanceof HTMLVideoElement?[i.videoWidth,i.videoHeight]:i instanceof VideoFrame?[i.codedWidth,i.codedHeight]:[i.width,i.height]},An=function(i,t){const{size:e,width:r,height:o,depthOrArrayLayers:f}=i;return!e&&!r&&lt(ot.TEXTURE_SIZE_NOT_FOUND,`\`${t}\` method.`),e??{width:r,height:o,depthOrArrayLayers:f}},Dn=function(i,t,e){!M(this,ut)&&lt(ot.RENDER_PIPELNE_NOT_FOUND,"texture with mipmaps."),M(this,ut).SavePipelineState(),M(this,ut).ResetPipelineState(),(!M(this,ke)||!M(this,Se))&&(L(this,ke,M(this,ut).CreateShaderModule(Fr)),L(this,Se,this.CreateSampler(t)));let r=0,o=i.width,f=i.height;for(M(this,ut).CreatePipeline({vertex:M(this,ut).CreateVertexState(M(this,ke)),fragment:M(this,ut).CreateFragmentState(M(this,ke),void 0,M(this,ut).CreateTargetState(i.format))});1<o||1<f;)o=Math.max(o*.5|0,1),f=Math.max(f*.5|0,1),e(r++);M(this,ut).SubmitCommandBuffer(),M(this,ut).SetCommandEncoder(void 0),M(this,ut).RestorePipelineState(),L(this,ke,L(this,Se,void 0))};var pn,xe,We,ve,qt,be,Xe,bn,ae,se,kt,ee,Ve,Ee,pe,fn,mn,wn,Be,yn,fe,ie,Cn,Un,Rn,qr;class Ks extends Dr{constructor(t,e,r,o){super(t,e,"Render"),$(this,ie),$(this,pn),$(this,xe,!1),$(this,We,new Float32Array(2)),$(this,ve,!1),$(this,qt),$(this,be),$(this,Xe),$(this,bn),$(this,ae),$(this,se),$(this,kt),$(this,ee),$(this,Ve),$(this,Ee,[0,0,0,0]),$(this,pe,[]),$(this,fn),$(this,mn),$(this,wn),$(this,Be,[0,0,0,0]),$(this,yn),$(this,fe),!r&&lt(ot.CANVAS_NOT_FOUND);const f=r.getContext("webgpu");!f&&lt(ot.CONTEXT_NOT_FOUND),f.configure({device:t,...o}),L(this,Xe,this.CreateBuffer({size:M(this,We).length*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,label:"Render Pipeline Resolution Buffer"})),L(this,qt,r),L(this,be,f),ft(this,ie,Cn).call(this),L(this,Ve,o.format),this.CreatePassDescriptor(this.CreateColorAttachment())}ConfigureContext(t){const e=t.format??M(this,Ve);M(this,be).configure({device:this.Device,format:e,...t})}CreateColorAttachment(t,e="clear",r="store",o,f,S){const A=o&&ft(this,ie,Un).call(this,o);return{view:t,loadOp:e,storeOp:r,clearValue:A,resolveTarget:f,depthSlice:S}}CreateDepthAttachment(t,e=1,r="clear",o="store",f){return L(this,ve,!0),L(this,bn,new Pr(this.Device)),{view:t,depthClearValue:e,depthLoadOp:r,depthStoreOp:o,depthReadOnly:f}}CreateStencilAttachment(t,e="clear",r="store",o){return{stencilClearValue:t,stencilLoadOp:e,stencilStoreOp:r,stencilReadOnly:o}}CreatePassDescriptor(t,e,r,o,f,S){const A=Array.isArray(t)&&t||[t];return L(this,xe,!A.some(({view:q})=>!!q)),e??(e=this.CreatePipelineLabel("Render Pass")),this.Descriptor={colorAttachments:A,depthStencilAttachment:r,occlusionQuerySet:o,timestampWrites:f,maxDrawCount:S,label:e}}CreateVertexBufferAttribute(t,e=0,r=0){return ft(this,ie,Rn).call(this,t,e,r)}CreateVertexBufferLayout(t,e,r="vertex"){!this.Reflect&&lt(ot.SHADER_MODULE_NOT_FOUND,"`Renderer.CreateVertexBufferLayout`.\n            Use `Renderer.CreateShaderModule` before creating vertex buffer layout.");const{entry:{vertex:o}}=this.Reflect,f=o.find(({name:q})=>r===q);!f&&lt(ot.VERTEX_ENTRY_NOT_FOUND,`\`${r}\` in vertex shader entries.`),t=Array.isArray(t)&&t||[t];let S=[],A=0;for(let q=0,V=t.length;q<V;++q){const Z=t[q],at=typeof Z=="string",wt=at?Z:Z.name,mt=f.inputs.find(({name:xt})=>wt===xt);if(mt){const xt=at?ss(mt.type.size):Z.format;S.push(ft(this,ie,Rn).call(this,xt,+mt.location,A)),A+=is(xt);continue}Me(ot.VERTEX_ATTRIBUTE_NOT_FOUND,`\`${wt}\` in vertex shader inputs.`)}return{arrayStride:A,stepMode:e,attributes:S}}CreateVertexState(t,e="vertex",r,o){return r=Array.isArray(r)&&r||[r],{module:t,entryPoint:e,buffers:r,constants:o}}CreateBlendComponent(t="add",e="one",r="zero"){return{operation:t,srcFactor:e,dstFactor:r}}CreateTargetState(t=M(this,Ve),e,r){return{format:t,blend:e,writeMask:r}}CreateFragmentState(t,e="fragment",r,o){return r??(r=this.CreateTargetState()),r=Array.isArray(r)&&r||[r],{module:t,entryPoint:e,targets:r,constants:o}}CreateStencilFaceState(t,e,r,o){return{compare:t,failOp:e,depthFailOp:r,passOp:o}}CreateDepthStencilState(t="depth24plus",e=!0,r="less",o,f,S,A,q,V,Z){return{format:t,depthWriteEnabled:e,depthCompare:r,stencilFront:o,stencilBack:f,stencilReadMask:S,stencilWriteMask:A,depthBias:q,depthBiasSlopeScale:V,depthBiasClamp:Z}}CreateMultisampleState(t=4,e,r){return{count:t,mask:e,alphaToCoverageEnabled:r}}CreatePipeline(t={},e){let r=this.GetShaderModule(t),{vertex:o,fragment:f}=t;!r&&!o&&(r=this.CreateShaderModule()),r&&(o??(o=this.CreateVertexState(r)),f??(f=this.CreateFragmentState(r)));const S=t.label??this.CreatePipelineLabel("Render Pipeline"),A=t.layout??"auto";return this.Pipeline=this.Device.createRenderPipeline({...t,label:S,layout:A,vertex:o,fragment:f}),e&&(M(this,kt)?M(this,kt).setPipeline(this.Pipeline):Me(ot.RENDER_PASS_NOT_FOUND)),this.Pipeline}SavePipelineState(){super.SavePipelineState(),L(this,fe,M(this,ee)),L(this,fn,M(this,pe)),L(this,Be,M(this,Ee)),L(this,yn,M(this,se)),L(this,mn,M(this,xe)),L(this,wn,M(this,ve)),M(this,fe)&&L(this,fe,Object.values(M(this,fe)))}ResetPipelineState(){super.ResetPipelineState(),this.SetIndexBuffer(void 0),L(this,se,void 0),L(this,xe,!1),L(this,Be,[0,0,0,0]),L(this,ve,!1)}RestorePipelineState(){super.RestorePipelineState(),L(this,pe,M(this,fn)),L(this,Ee,M(this,Be)),L(this,se,M(this,yn)),L(this,xe,M(this,mn)),L(this,ve,M(this,wn)),this.SetIndexBuffer(...Array.isArray(M(this,fe))&&M(this,fe)||[void 0])}SetVertexBuffers(t,e,r){e=Array.isArray(e)&&e||[e],r=Array.isArray(r)&&r||[r],L(this,pe,Array.isArray(t)&&t.map((o,f)=>({buffer:o,offset:e[f],size:r[f]}))||[{buffer:t,offset:e[0],size:r[0]}])}AddVertexBuffers(t,e,r){e=Array.isArray(e)&&e||[e],r=Array.isArray(r)&&r||[r],M(this,pe).push(...Array.isArray(t)&&t.map((o,f)=>({buffer:o,offset:e[f],size:r[f]}))||[{buffer:t,offset:e[0],size:r[0]}])}SetIndexBuffer(t,e="uint32",r,o){L(this,ee,t&&{buffer:t,format:e,offset:r,size:o})}SetCanvasSize(t,e){!this.Device&&lt(ot.DEVICE_NOT_FOUND),!M(this,qt)&&lt(ot.CANVAS_NOT_FOUND);const{maxTextureDimension2D:r}=this.Device.limits;t=Math.max(1,Math.min(t,r)),e=Math.max(1,Math.min(e,r)),(M(this,qt).width!==t||M(this,qt).height!==e)&&(M(this,qt).width=t,M(this,qt).height=e,ft(this,ie,Cn).call(this))}Render(t,e=!0){M(this,ve)&&ft(this,ie,qr).call(this),M(this,kt)||(M(this,se)?(this.Descriptor.colorAttachments[0].view=M(this,se).createView(),this.Descriptor.colorAttachments[0].resolveTarget=this.CurrentTextureView):M(this,xe)&&(this.Descriptor.colorAttachments[0].view=this.CurrentTextureView),L(this,kt,this.GetCommandEncoder().beginRenderPass(this.Descriptor)),M(this,kt).setPipeline(this.Pipeline),L(this,pn,M(this,ee)?M(this,kt).drawIndexed.bind(M(this,kt)):M(this,kt).draw.bind(M(this,kt))));for(let r=0,o=M(this,pe).length;r<o;++r){const{buffer:f,offset:S,size:A}=M(this,pe)[r];M(this,kt).setVertexBuffer(r,f,S,A)}M(this,ee)&&M(this,kt).setIndexBuffer(M(this,ee).buffer,M(this,ee).format,M(this,ee).offset,M(this,ee).size);for(let r=0,o=0,f=this.BindGroups.length;r<f;++r){const{bindGroup:S,dynamicOffsets:A,active:q}=this.BindGroups[r];q&&M(this,kt).setBindGroup(o++,S,A)}M(this,kt).setBlendConstant(M(this,Ee)),M(this,pn).call(this,...Array.isArray(t)&&t||[t]),e&&this.Submit()}DestroyCurrentPass(){var t;(t=M(this,kt))==null||t.end(),L(this,kt,void 0)}Submit(){this.DestroyCurrentPass(),this.SubmitCommandBuffer(),this.SetCommandEncoder(void 0)}Destroy(){var t;this.DestroyCurrentPass(),(t=M(this,be))==null||t.unconfigure()}get Canvas(){return M(this,qt)}get Context(){return M(this,be)}get CurrentPass(){return M(this,kt)}get AspectRatio(){return!M(this,qt)&&lt(ot.CANVAS_NOT_FOUND),M(this,qt).width/M(this,qt).height}get DepthTexture(){return M(this,ae)}get CurrentTexture(){return M(this,be).getCurrentTexture()}get CurrentTextureView(){return this.CurrentTexture.createView()}set MultisampleTexture(t){L(this,se,t)}get MultisampleTexture(){return M(this,se)}set BlendConstant(t){L(this,Ee,ft(this,ie,Un).call(this,t))}get BlendConstant(){return M(this,Ee)}get ResolutionBuffer(){return M(this,Xe)}}pn=new WeakMap,xe=new WeakMap,We=new WeakMap,ve=new WeakMap,qt=new WeakMap,be=new WeakMap,Xe=new WeakMap,bn=new WeakMap,ae=new WeakMap,se=new WeakMap,kt=new WeakMap,ee=new WeakMap,Ve=new WeakMap,Ee=new WeakMap,pe=new WeakMap,fn=new WeakMap,mn=new WeakMap,wn=new WeakMap,Be=new WeakMap,yn=new WeakMap,fe=new WeakMap,ie=new WeakSet,Cn=function(){M(this,We).set([M(this,qt).width,M(this,qt).height]),this.WriteBuffer(M(this,Xe),M(this,We))},Un=function(i){return i instanceof Yr?i.rgba:i},Rn=function(i,t=0,e=0){return{format:i,shaderLocation:t,offset:e}},qr=function(){var i;const t=this.CurrentTexture,{width:e,height:r}=t;(!M(this,ae)||M(this,ae).width!==e||M(this,ae).height!==r)&&((i=M(this,ae))==null||i.destroy(),L(this,ae,M(this,bn).CreateTextureFromSource(t,{usage:GPUTextureUsage.RENDER_ATTACHMENT,label:"Depth Texture",format:"depth24plus",mipmaps:!1}))),this.Descriptor.depthStencilAttachment.view=M(this,ae).createView()};var gn;class ti extends Dr{constructor(t,e){super(t,e,"Compute"),$(this,gn,[1])}CreatePassDescriptor(t,e,r,o){return t??(t=this.CreatePipelineLabel("Compute Pass")),this.Descriptor={label:t,timestampWrites:e?{querySet:e,beginningOfPassWriteIndex:r,endOfPassWriteIndex:o}:void 0}}SetPassDescriptor(t){this.Descriptor=t}CreatePipeline(t){const e=t.label??this.CreatePipelineLabel("Compute Pipeline"),r=t.layout??"auto",o=this.GetShaderModule(t)??this.CreateShaderModule();return this.Pipeline=this.Device.createComputePipeline({label:e,layout:r,compute:{module:o,...t}})}Compute(t=!1){const e=this.GetCommandEncoder().beginComputePass(this.Descriptor);e.setPipeline(this.Pipeline);for(let r=0,o=0,f=this.BindGroups.length;r<f;++r){const{bindGroup:S,dynamicOffsets:A,active:q}=this.BindGroups[r];q&&e.setBindGroup(o++,S,A)}e.dispatchWorkgroups(...M(this,gn)),e.end(),t&&this.Submit()}Submit(){this.SubmitCommandBuffer(),this.SetCommandEncoder(void 0)}set Workgroups(t){L(this,gn,Array.isArray(t)&&t||[t])}}gn=new WeakMap;/**
 * @module UWAL
 * @author Ustym Ukhman <ustym.ukhman@gmail.com>
 * @description Unopinionated WebGPU Abstraction Library
 * @version 0.0.8
 * @license MIT
 */var qe,He,Qe,oe,Ne,Fn,lr,Ir,Lr;const At=class ht{static RenderPipeline(t,e="",r={}){return r.format??(r.format=ht.PreferredCanvasFormat),ft(this,Ne,Fn).call(this,e),(async()=>{const o=await ht.Device;return new Proxy(Ks,{construct(f){return new f(o,e,t,r)}})})()}static ComputePipeline(t=""){return ft(this,Ne,Fn).call(this,t),(async()=>{const e=await ht.Device;return new Proxy(ti,{construct(r){return new r(e,t)}})})()}static Texture(t){return(async()=>{const e=await ht.Device;return new Proxy(Pr,{construct(r){return new r(e,t)}})})()}static Destroy(t,e,r){var o;t=Array.isArray(t)&&t||[t],t.forEach(f=>f?.destroy()),e=Array.isArray(e)&&e||[e],e.forEach(f=>f?.destroy()),r=Array.isArray(r)&&r||[r],r.forEach(f=>f?.destroy()),(o=M(ht,qe))==null||o.destroy(),L(ht,He,L(ht,qe,null)),ht.PowerPreference=ht.ForceFallbackAdapter=void 0,ht.DescriptorLabel=M(ht,oe).requiredFeatures=ht.RequiredLimits=void 0}static set PowerPreference(t){M(ht,Qe).powerPreference=t}static set ForceFallbackAdapter(t){M(ht,Qe).forceFallbackAdapter=t}static set DescriptorLabel(t){M(ht,oe).label=t}static async SetRequiredFeatures(t){const e=(await ht.Adapter).features,r=M(ht,oe).requiredFeatures??[];return t=Array.isArray(t)&&t||[t],t.forEach(o=>e.has(o)?r.push(o):Me(ot.FEATURE_NOT_FOUND,`"${o}".
It will be skipped when requesting a GPUDevice.`)),M(ht,oe).requiredFeatures=r}static set RequiredLimits(t){M(ht,oe).requiredLimits=t}static get PreferredCanvasFormat(){return!navigator.gpu&&lt(ot.WEBGPU_NOT_SUPPORTED),navigator.gpu.getPreferredCanvasFormat()}static get Adapter(){return(async()=>{var t;return M(ht,He)??await ft(t=ht,Ne,Ir).call(t)()})()}static get Device(){return(async()=>{var t;return M(ht,qe)??await ft(t=ht,Ne,Lr).call(t)()})()}static get VERSION(){return"0.0.8"}};qe=new WeakMap,He=new WeakMap,Qe=new WeakMap,oe=new WeakMap,Ne=new WeakSet,Fn=function(i){var t;(t=M(At,oe)).label??(t.label=i&&`${i} Device`||"")},lr=function(i){if(At.OnDeviceLost)return At.OnDeviceLost(i);const t=(i.message&&` | Message: ${i.message}`)??".";lt(ot.DEVICE_LOST,`Reason: ${i.reason}`+t)},Ir=function(){return!navigator.gpu&&lt(ot.WEBGPU_NOT_SUPPORTED),async()=>{const i=await navigator.gpu.requestAdapter(M(At,Qe));return!i&&lt(ot.ADAPTER_NOT_FOUND),L(At,He,i)}},Lr=function(){return async()=>{const{requiredFeatures:i,requiredLimits:t,label:e}=M(At,oe),r=await(await At.Adapter).requestDevice({requiredFeatures:i,requiredLimits:t,defaultQueue:{label:e}});return!r&&lt(ot.DEVICE_NOT_FOUND),r.lost.then(ft(At,Ne,lr)),L(At,qe,r)}},$(At,Ne),$(At,qe,null),$(At,He,null),$(At,Qe,{powerPreference:void 0,forceFallbackAdapter:!1}),De(At,"OnDeviceLost"),$(At,oe,{label:void 0,requiredFeatures:void 0,requiredLimits:void 0});let zr=At;function ei(i,t){return class extends i{constructor(...e){super(...e),t(this)}}}const ni=ei(Array,i=>i.fill(0));let K=1e-6;function ri(i){function t(n=0,c=0){const s=new i(2);return n!==void 0&&(s[0]=n,c!==void 0&&(s[1]=c)),s}const e=t;function r(n,c,s){const a=s??new i(2);return a[0]=n,a[1]=c,a}function o(n,c){const s=c??new i(2);return s[0]=Math.ceil(n[0]),s[1]=Math.ceil(n[1]),s}function f(n,c){const s=c??new i(2);return s[0]=Math.floor(n[0]),s[1]=Math.floor(n[1]),s}function S(n,c){const s=c??new i(2);return s[0]=Math.round(n[0]),s[1]=Math.round(n[1]),s}function A(n,c=0,s=1,a){const p=a??new i(2);return p[0]=Math.min(s,Math.max(c,n[0])),p[1]=Math.min(s,Math.max(c,n[1])),p}function q(n,c,s){const a=s??new i(2);return a[0]=n[0]+c[0],a[1]=n[1]+c[1],a}function V(n,c,s,a){const p=a??new i(2);return p[0]=n[0]+c[0]*s,p[1]=n[1]+c[1]*s,p}function Z(n,c){const s=n[0],a=n[1],p=c[0],b=c[1],C=Math.sqrt(s*s+a*a),u=Math.sqrt(p*p+b*b),d=C*u,y=d&&Bt(n,c)/d;return Math.acos(y)}function at(n,c,s){const a=s??new i(2);return a[0]=n[0]-c[0],a[1]=n[1]-c[1],a}const wt=at;function mt(n,c){return Math.abs(n[0]-c[0])<K&&Math.abs(n[1]-c[1])<K}function xt(n,c){return n[0]===c[0]&&n[1]===c[1]}function It(n,c,s,a){const p=a??new i(2);return p[0]=n[0]+s*(c[0]-n[0]),p[1]=n[1]+s*(c[1]-n[1]),p}function Lt(n,c,s,a){const p=a??new i(2);return p[0]=n[0]+s[0]*(c[0]-n[0]),p[1]=n[1]+s[1]*(c[1]-n[1]),p}function Yt(n,c,s){const a=s??new i(2);return a[0]=Math.max(n[0],c[0]),a[1]=Math.max(n[1],c[1]),a}function Pt(n,c,s){const a=s??new i(2);return a[0]=Math.min(n[0],c[0]),a[1]=Math.min(n[1],c[1]),a}function Dt(n,c,s){const a=s??new i(2);return a[0]=n[0]*c,a[1]=n[1]*c,a}const Zt=Dt;function zt(n,c,s){const a=s??new i(2);return a[0]=n[0]/c,a[1]=n[1]/c,a}function Gt(n,c){const s=c??new i(2);return s[0]=1/n[0],s[1]=1/n[1],s}const Qt=Gt;function Vt(n,c,s){const a=s??new i(3),p=n[0]*c[1]-n[1]*c[0];return a[0]=0,a[1]=0,a[2]=p,a}function Bt(n,c){return n[0]*c[0]+n[1]*c[1]}function vt(n){const c=n[0],s=n[1];return Math.sqrt(c*c+s*s)}const jt=vt;function st(n){const c=n[0],s=n[1];return c*c+s*s}const ct=st;function et(n,c){const s=n[0]-c[0],a=n[1]-c[1];return Math.sqrt(s*s+a*a)}const w=et;function P(n,c){const s=n[0]-c[0],a=n[1]-c[1];return s*s+a*a}const N=P;function R(n,c){const s=c??new i(2),a=n[0],p=n[1],b=Math.sqrt(a*a+p*p);return b>1e-5?(s[0]=a/b,s[1]=p/b):(s[0]=0,s[1]=0),s}function W(n,c){const s=c??new i(2);return s[0]=-n[0],s[1]=-n[1],s}function z(n,c){const s=c??new i(2);return s[0]=n[0],s[1]=n[1],s}const j=z;function J(n,c,s){const a=s??new i(2);return a[0]=n[0]*c[0],a[1]=n[1]*c[1],a}const nt=J;function H(n,c,s){const a=s??new i(2);return a[0]=n[0]/c[0],a[1]=n[1]/c[1],a}const Q=H;function it(n=1,c){const s=c??new i(2),a=Math.random()*2*Math.PI;return s[0]=Math.cos(a)*n,s[1]=Math.sin(a)*n,s}function E(n){const c=n??new i(2);return c[0]=0,c[1]=0,c}function F(n,c,s){const a=s??new i(2),p=n[0],b=n[1];return a[0]=p*c[0]+b*c[4]+c[12],a[1]=p*c[1]+b*c[5]+c[13],a}function l(n,c,s){const a=s??new i(2),p=n[0],b=n[1];return a[0]=c[0]*p+c[4]*b+c[8],a[1]=c[1]*p+c[5]*b+c[9],a}function _(n,c,s,a){const p=a??new i(2),b=n[0]-c[0],C=n[1]-c[1],u=Math.sin(s),d=Math.cos(s);return p[0]=b*d-C*u+c[0],p[1]=b*u+C*d+c[1],p}function m(n,c,s){const a=s??new i(2);return R(n,a),Dt(a,c,a)}function v(n,c,s){const a=s??new i(2);return vt(n)>c?m(n,c,a):z(n,a)}function I(n,c,s){const a=s??new i(2);return It(n,c,.5,a)}return{create:t,fromValues:e,set:r,ceil:o,floor:f,round:S,clamp:A,add:q,addScaled:V,angle:Z,subtract:at,sub:wt,equalsApproximately:mt,equals:xt,lerp:It,lerpV:Lt,max:Yt,min:Pt,mulScalar:Dt,scale:Zt,divScalar:zt,inverse:Gt,invert:Qt,cross:Vt,dot:Bt,length:vt,len:jt,lengthSq:st,lenSq:ct,distance:et,dist:w,distanceSq:P,distSq:N,normalize:R,negate:W,copy:z,clone:j,multiply:J,mul:nt,divide:H,div:Q,random:it,zero:E,transformMat4:F,transformMat3:l,rotate:_,setLength:m,truncate:v,midpoint:I}}const _r=new Map;function Gr(i){let t=_r.get(i);return t||(t=ri(i),_r.set(i,t)),t}function si(i){const t=Gr(i);function e(w,P,N,R,W,z,j,J,nt){const H=new i(12);return H[3]=0,H[7]=0,H[11]=0,w!==void 0&&(H[0]=w,P!==void 0&&(H[1]=P,N!==void 0&&(H[2]=N,R!==void 0&&(H[4]=R,W!==void 0&&(H[5]=W,z!==void 0&&(H[6]=z,j!==void 0&&(H[8]=j,J!==void 0&&(H[9]=J,nt!==void 0&&(H[10]=nt))))))))),H}function r(w,P,N,R,W,z,j,J,nt,H){const Q=H??new i(12);return Q[0]=w,Q[1]=P,Q[2]=N,Q[3]=0,Q[4]=R,Q[5]=W,Q[6]=z,Q[7]=0,Q[8]=j,Q[9]=J,Q[10]=nt,Q[11]=0,Q}function o(w,P){const N=P??new i(12);return N[0]=w[0],N[1]=w[1],N[2]=w[2],N[3]=0,N[4]=w[4],N[5]=w[5],N[6]=w[6],N[7]=0,N[8]=w[8],N[9]=w[9],N[10]=w[10],N[11]=0,N}function f(w,P){const N=P??new i(12),R=w[0],W=w[1],z=w[2],j=w[3],J=R+R,nt=W+W,H=z+z,Q=R*J,it=W*J,E=W*nt,F=z*J,l=z*nt,_=z*H,m=j*J,v=j*nt,I=j*H;return N[0]=1-E-_,N[1]=it+I,N[2]=F-v,N[3]=0,N[4]=it-I,N[5]=1-Q-_,N[6]=l+m,N[7]=0,N[8]=F+v,N[9]=l-m,N[10]=1-Q-E,N[11]=0,N}function S(w,P){const N=P??new i(12);return N[0]=-w[0],N[1]=-w[1],N[2]=-w[2],N[4]=-w[4],N[5]=-w[5],N[6]=-w[6],N[8]=-w[8],N[9]=-w[9],N[10]=-w[10],N}function A(w,P){const N=P??new i(12);return N[0]=w[0],N[1]=w[1],N[2]=w[2],N[4]=w[4],N[5]=w[5],N[6]=w[6],N[8]=w[8],N[9]=w[9],N[10]=w[10],N}const q=A;function V(w,P){return Math.abs(w[0]-P[0])<K&&Math.abs(w[1]-P[1])<K&&Math.abs(w[2]-P[2])<K&&Math.abs(w[4]-P[4])<K&&Math.abs(w[5]-P[5])<K&&Math.abs(w[6]-P[6])<K&&Math.abs(w[8]-P[8])<K&&Math.abs(w[9]-P[9])<K&&Math.abs(w[10]-P[10])<K}function Z(w,P){return w[0]===P[0]&&w[1]===P[1]&&w[2]===P[2]&&w[4]===P[4]&&w[5]===P[5]&&w[6]===P[6]&&w[8]===P[8]&&w[9]===P[9]&&w[10]===P[10]}function at(w){const P=w??new i(12);return P[0]=1,P[1]=0,P[2]=0,P[4]=0,P[5]=1,P[6]=0,P[8]=0,P[9]=0,P[10]=1,P}function wt(w,P){const N=P??new i(12);if(N===w){let E;return E=w[1],w[1]=w[4],w[4]=E,E=w[2],w[2]=w[8],w[8]=E,E=w[6],w[6]=w[9],w[9]=E,N}const R=w[0*4+0],W=w[0*4+1],z=w[0*4+2],j=w[1*4+0],J=w[1*4+1],nt=w[1*4+2],H=w[2*4+0],Q=w[2*4+1],it=w[2*4+2];return N[0]=R,N[1]=j,N[2]=H,N[4]=W,N[5]=J,N[6]=Q,N[8]=z,N[9]=nt,N[10]=it,N}function mt(w,P){const N=P??new i(12),R=w[0*4+0],W=w[0*4+1],z=w[0*4+2],j=w[1*4+0],J=w[1*4+1],nt=w[1*4+2],H=w[2*4+0],Q=w[2*4+1],it=w[2*4+2],E=it*J-nt*Q,F=-it*j+nt*H,l=Q*j-J*H,_=1/(R*E+W*F+z*l);return N[0]=E*_,N[1]=(-it*W+z*Q)*_,N[2]=(nt*W-z*J)*_,N[4]=F*_,N[5]=(it*R-z*H)*_,N[6]=(-nt*R+z*j)*_,N[8]=l*_,N[9]=(-Q*R+W*H)*_,N[10]=(J*R-W*j)*_,N}function xt(w){const P=w[0],N=w[0*4+1],R=w[0*4+2],W=w[1*4+0],z=w[1*4+1],j=w[1*4+2],J=w[2*4+0],nt=w[2*4+1],H=w[2*4+2];return P*(z*H-nt*j)-W*(N*H-nt*R)+J*(N*j-z*R)}const It=mt;function Lt(w,P,N){const R=N??new i(12),W=w[0],z=w[1],j=w[2],J=w[4],nt=w[5],H=w[6],Q=w[8],it=w[9],E=w[10],F=P[0],l=P[1],_=P[2],m=P[4],v=P[5],I=P[6],n=P[8],c=P[9],s=P[10];return R[0]=W*F+J*l+Q*_,R[1]=z*F+nt*l+it*_,R[2]=j*F+H*l+E*_,R[4]=W*m+J*v+Q*I,R[5]=z*m+nt*v+it*I,R[6]=j*m+H*v+E*I,R[8]=W*n+J*c+Q*s,R[9]=z*n+nt*c+it*s,R[10]=j*n+H*c+E*s,R}const Yt=Lt;function Pt(w,P,N){const R=N??at();return w!==R&&(R[0]=w[0],R[1]=w[1],R[2]=w[2],R[4]=w[4],R[5]=w[5],R[6]=w[6]),R[8]=P[0],R[9]=P[1],R[10]=1,R}function Dt(w,P){const N=P??t.create();return N[0]=w[8],N[1]=w[9],N}function Zt(w,P,N){const R=N??t.create(),W=P*4;return R[0]=w[W+0],R[1]=w[W+1],R}function zt(w,P,N,R){const W=R===w?w:A(w,R),z=N*4;return W[z+0]=P[0],W[z+1]=P[1],W}function Gt(w,P){const N=P??t.create(),R=w[0],W=w[1],z=w[4],j=w[5];return N[0]=Math.sqrt(R*R+W*W),N[1]=Math.sqrt(z*z+j*j),N}function Qt(w,P){const N=P??new i(12);return N[0]=1,N[1]=0,N[2]=0,N[4]=0,N[5]=1,N[6]=0,N[8]=w[0],N[9]=w[1],N[10]=1,N}function Vt(w,P,N){const R=N??new i(12),W=P[0],z=P[1],j=w[0],J=w[1],nt=w[2],H=w[1*4+0],Q=w[1*4+1],it=w[1*4+2],E=w[2*4+0],F=w[2*4+1],l=w[2*4+2];return w!==R&&(R[0]=j,R[1]=J,R[2]=nt,R[4]=H,R[5]=Q,R[6]=it),R[8]=j*W+H*z+E,R[9]=J*W+Q*z+F,R[10]=nt*W+it*z+l,R}function Bt(w,P){const N=P??new i(12),R=Math.cos(w),W=Math.sin(w);return N[0]=R,N[1]=W,N[2]=0,N[4]=-W,N[5]=R,N[6]=0,N[8]=0,N[9]=0,N[10]=1,N}function vt(w,P,N){const R=N??new i(12),W=w[0*4+0],z=w[0*4+1],j=w[0*4+2],J=w[1*4+0],nt=w[1*4+1],H=w[1*4+2],Q=Math.cos(P),it=Math.sin(P);return R[0]=Q*W+it*J,R[1]=Q*z+it*nt,R[2]=Q*j+it*H,R[4]=Q*J-it*W,R[5]=Q*nt-it*z,R[6]=Q*H-it*j,w!==R&&(R[8]=w[8],R[9]=w[9],R[10]=w[10]),R}function jt(w,P){const N=P??new i(12);return N[0]=w[0],N[1]=0,N[2]=0,N[4]=0,N[5]=w[1],N[6]=0,N[8]=0,N[9]=0,N[10]=1,N}function st(w,P,N){const R=N??new i(12),W=P[0],z=P[1];return R[0]=W*w[0*4+0],R[1]=W*w[0*4+1],R[2]=W*w[0*4+2],R[4]=z*w[1*4+0],R[5]=z*w[1*4+1],R[6]=z*w[1*4+2],w!==R&&(R[8]=w[8],R[9]=w[9],R[10]=w[10]),R}function ct(w,P){const N=P??new i(12);return N[0]=w,N[1]=0,N[2]=0,N[4]=0,N[5]=w,N[6]=0,N[8]=0,N[9]=0,N[10]=1,N}function et(w,P,N){const R=N??new i(12);return R[0]=P*w[0*4+0],R[1]=P*w[0*4+1],R[2]=P*w[0*4+2],R[4]=P*w[1*4+0],R[5]=P*w[1*4+1],R[6]=P*w[1*4+2],w!==R&&(R[8]=w[8],R[9]=w[9],R[10]=w[10]),R}return{clone:q,create:e,set:r,fromMat4:o,fromQuat:f,negate:S,copy:A,equalsApproximately:V,equals:Z,identity:at,transpose:wt,inverse:mt,invert:It,determinant:xt,mul:Yt,multiply:Lt,setTranslation:Pt,getTranslation:Dt,getAxis:Zt,setAxis:zt,getScaling:Gt,translation:Qt,translate:Vt,rotation:Bt,rotate:vt,scaling:jt,scale:st,uniformScaling:ct,uniformScale:et}}const dr=new Map;function ii(i){let t=dr.get(i);return t||(t=si(i),dr.set(i,t)),t}function ai(i){function t(u,d,y){const k=new i(3);return u!==void 0&&(k[0]=u,d!==void 0&&(k[1]=d,y!==void 0&&(k[2]=y))),k}const e=t;function r(u,d,y,k){const O=k??new i(3);return O[0]=u,O[1]=d,O[2]=y,O}function o(u,d){const y=d??new i(3);return y[0]=Math.ceil(u[0]),y[1]=Math.ceil(u[1]),y[2]=Math.ceil(u[2]),y}function f(u,d){const y=d??new i(3);return y[0]=Math.floor(u[0]),y[1]=Math.floor(u[1]),y[2]=Math.floor(u[2]),y}function S(u,d){const y=d??new i(3);return y[0]=Math.round(u[0]),y[1]=Math.round(u[1]),y[2]=Math.round(u[2]),y}function A(u,d=0,y=1,k){const O=k??new i(3);return O[0]=Math.min(y,Math.max(d,u[0])),O[1]=Math.min(y,Math.max(d,u[1])),O[2]=Math.min(y,Math.max(d,u[2])),O}function q(u,d,y){const k=y??new i(3);return k[0]=u[0]+d[0],k[1]=u[1]+d[1],k[2]=u[2]+d[2],k}function V(u,d,y,k){const O=k??new i(3);return O[0]=u[0]+d[0]*y,O[1]=u[1]+d[1]*y,O[2]=u[2]+d[2]*y,O}function Z(u,d){const y=u[0],k=u[1],O=u[2],D=d[0],U=d[1],X=d[2],Y=Math.sqrt(y*y+k*k+O*O),G=Math.sqrt(D*D+U*U+X*X),B=Y*G,tt=B&&Bt(u,d)/B;return Math.acos(tt)}function at(u,d,y){const k=y??new i(3);return k[0]=u[0]-d[0],k[1]=u[1]-d[1],k[2]=u[2]-d[2],k}const wt=at;function mt(u,d){return Math.abs(u[0]-d[0])<K&&Math.abs(u[1]-d[1])<K&&Math.abs(u[2]-d[2])<K}function xt(u,d){return u[0]===d[0]&&u[1]===d[1]&&u[2]===d[2]}function It(u,d,y,k){const O=k??new i(3);return O[0]=u[0]+y*(d[0]-u[0]),O[1]=u[1]+y*(d[1]-u[1]),O[2]=u[2]+y*(d[2]-u[2]),O}function Lt(u,d,y,k){const O=k??new i(3);return O[0]=u[0]+y[0]*(d[0]-u[0]),O[1]=u[1]+y[1]*(d[1]-u[1]),O[2]=u[2]+y[2]*(d[2]-u[2]),O}function Yt(u,d,y){const k=y??new i(3);return k[0]=Math.max(u[0],d[0]),k[1]=Math.max(u[1],d[1]),k[2]=Math.max(u[2],d[2]),k}function Pt(u,d,y){const k=y??new i(3);return k[0]=Math.min(u[0],d[0]),k[1]=Math.min(u[1],d[1]),k[2]=Math.min(u[2],d[2]),k}function Dt(u,d,y){const k=y??new i(3);return k[0]=u[0]*d,k[1]=u[1]*d,k[2]=u[2]*d,k}const Zt=Dt;function zt(u,d,y){const k=y??new i(3);return k[0]=u[0]/d,k[1]=u[1]/d,k[2]=u[2]/d,k}function Gt(u,d){const y=d??new i(3);return y[0]=1/u[0],y[1]=1/u[1],y[2]=1/u[2],y}const Qt=Gt;function Vt(u,d,y){const k=y??new i(3),O=u[2]*d[0]-u[0]*d[2],D=u[0]*d[1]-u[1]*d[0];return k[0]=u[1]*d[2]-u[2]*d[1],k[1]=O,k[2]=D,k}function Bt(u,d){return u[0]*d[0]+u[1]*d[1]+u[2]*d[2]}function vt(u){const d=u[0],y=u[1],k=u[2];return Math.sqrt(d*d+y*y+k*k)}const jt=vt;function st(u){const d=u[0],y=u[1],k=u[2];return d*d+y*y+k*k}const ct=st;function et(u,d){const y=u[0]-d[0],k=u[1]-d[1],O=u[2]-d[2];return Math.sqrt(y*y+k*k+O*O)}const w=et;function P(u,d){const y=u[0]-d[0],k=u[1]-d[1],O=u[2]-d[2];return y*y+k*k+O*O}const N=P;function R(u,d){const y=d??new i(3),k=u[0],O=u[1],D=u[2],U=Math.sqrt(k*k+O*O+D*D);return U>1e-5?(y[0]=k/U,y[1]=O/U,y[2]=D/U):(y[0]=0,y[1]=0,y[2]=0),y}function W(u,d){const y=d??new i(3);return y[0]=-u[0],y[1]=-u[1],y[2]=-u[2],y}function z(u,d){const y=d??new i(3);return y[0]=u[0],y[1]=u[1],y[2]=u[2],y}const j=z;function J(u,d,y){const k=y??new i(3);return k[0]=u[0]*d[0],k[1]=u[1]*d[1],k[2]=u[2]*d[2],k}const nt=J;function H(u,d,y){const k=y??new i(3);return k[0]=u[0]/d[0],k[1]=u[1]/d[1],k[2]=u[2]/d[2],k}const Q=H;function it(u=1,d){const y=d??new i(3),k=Math.random()*2*Math.PI,O=Math.random()*2-1,D=Math.sqrt(1-O*O)*u;return y[0]=Math.cos(k)*D,y[1]=Math.sin(k)*D,y[2]=O*u,y}function E(u){const d=u??new i(3);return d[0]=0,d[1]=0,d[2]=0,d}function F(u,d,y){const k=y??new i(3),O=u[0],D=u[1],U=u[2],X=d[3]*O+d[7]*D+d[11]*U+d[15]||1;return k[0]=(d[0]*O+d[4]*D+d[8]*U+d[12])/X,k[1]=(d[1]*O+d[5]*D+d[9]*U+d[13])/X,k[2]=(d[2]*O+d[6]*D+d[10]*U+d[14])/X,k}function l(u,d,y){const k=y??new i(3),O=u[0],D=u[1],U=u[2];return k[0]=O*d[0*4+0]+D*d[1*4+0]+U*d[2*4+0],k[1]=O*d[0*4+1]+D*d[1*4+1]+U*d[2*4+1],k[2]=O*d[0*4+2]+D*d[1*4+2]+U*d[2*4+2],k}function _(u,d,y){const k=y??new i(3),O=u[0],D=u[1],U=u[2];return k[0]=O*d[0]+D*d[4]+U*d[8],k[1]=O*d[1]+D*d[5]+U*d[9],k[2]=O*d[2]+D*d[6]+U*d[10],k}function m(u,d,y){const k=y??new i(3),O=d[0],D=d[1],U=d[2],X=d[3]*2,Y=u[0],G=u[1],B=u[2],tt=D*B-U*G,rt=U*Y-O*B,dt=O*G-D*Y;return k[0]=Y+tt*X+(D*dt-U*rt)*2,k[1]=G+rt*X+(U*tt-O*dt)*2,k[2]=B+dt*X+(O*rt-D*tt)*2,k}function v(u,d){const y=d??new i(3);return y[0]=u[12],y[1]=u[13],y[2]=u[14],y}function I(u,d,y){const k=y??new i(3),O=d*4;return k[0]=u[O+0],k[1]=u[O+1],k[2]=u[O+2],k}function n(u,d){const y=d??new i(3),k=u[0],O=u[1],D=u[2],U=u[4],X=u[5],Y=u[6],G=u[8],B=u[9],tt=u[10];return y[0]=Math.sqrt(k*k+O*O+D*D),y[1]=Math.sqrt(U*U+X*X+Y*Y),y[2]=Math.sqrt(G*G+B*B+tt*tt),y}function c(u,d,y,k){const O=k??new i(3),D=[],U=[];return D[0]=u[0]-d[0],D[1]=u[1]-d[1],D[2]=u[2]-d[2],U[0]=D[0],U[1]=D[1]*Math.cos(y)-D[2]*Math.sin(y),U[2]=D[1]*Math.sin(y)+D[2]*Math.cos(y),O[0]=U[0]+d[0],O[1]=U[1]+d[1],O[2]=U[2]+d[2],O}function s(u,d,y,k){const O=k??new i(3),D=[],U=[];return D[0]=u[0]-d[0],D[1]=u[1]-d[1],D[2]=u[2]-d[2],U[0]=D[2]*Math.sin(y)+D[0]*Math.cos(y),U[1]=D[1],U[2]=D[2]*Math.cos(y)-D[0]*Math.sin(y),O[0]=U[0]+d[0],O[1]=U[1]+d[1],O[2]=U[2]+d[2],O}function a(u,d,y,k){const O=k??new i(3),D=[],U=[];return D[0]=u[0]-d[0],D[1]=u[1]-d[1],D[2]=u[2]-d[2],U[0]=D[0]*Math.cos(y)-D[1]*Math.sin(y),U[1]=D[0]*Math.sin(y)+D[1]*Math.cos(y),U[2]=D[2],O[0]=U[0]+d[0],O[1]=U[1]+d[1],O[2]=U[2]+d[2],O}function p(u,d,y){const k=y??new i(3);return R(u,k),Dt(k,d,k)}function b(u,d,y){const k=y??new i(3);return vt(u)>d?p(u,d,k):z(u,k)}function C(u,d,y){const k=y??new i(3);return It(u,d,.5,k)}return{create:t,fromValues:e,set:r,ceil:o,floor:f,round:S,clamp:A,add:q,addScaled:V,angle:Z,subtract:at,sub:wt,equalsApproximately:mt,equals:xt,lerp:It,lerpV:Lt,max:Yt,min:Pt,mulScalar:Dt,scale:Zt,divScalar:zt,inverse:Gt,invert:Qt,cross:Vt,dot:Bt,length:vt,len:jt,lengthSq:st,lenSq:ct,distance:et,dist:w,distanceSq:P,distSq:N,normalize:R,negate:W,copy:z,clone:j,multiply:J,mul:nt,divide:H,div:Q,random:it,zero:E,transformMat4:F,transformMat4Upper3x3:l,transformMat3:_,transformQuat:m,getTranslation:v,getAxis:I,getScaling:n,rotateX:c,rotateY:s,rotateZ:a,setLength:p,truncate:b,midpoint:C}}const pr=new Map;function Ln(i){let t=pr.get(i);return t||(t=ai(i),pr.set(i,t)),t}function oi(i){const t=Ln(i);function e(n,c,s,a,p,b,C,u,d,y,k,O,D,U,X,Y){const G=new i(16);return n!==void 0&&(G[0]=n,c!==void 0&&(G[1]=c,s!==void 0&&(G[2]=s,a!==void 0&&(G[3]=a,p!==void 0&&(G[4]=p,b!==void 0&&(G[5]=b,C!==void 0&&(G[6]=C,u!==void 0&&(G[7]=u,d!==void 0&&(G[8]=d,y!==void 0&&(G[9]=y,k!==void 0&&(G[10]=k,O!==void 0&&(G[11]=O,D!==void 0&&(G[12]=D,U!==void 0&&(G[13]=U,X!==void 0&&(G[14]=X,Y!==void 0&&(G[15]=Y)))))))))))))))),G}function r(n,c,s,a,p,b,C,u,d,y,k,O,D,U,X,Y,G){const B=G??new i(16);return B[0]=n,B[1]=c,B[2]=s,B[3]=a,B[4]=p,B[5]=b,B[6]=C,B[7]=u,B[8]=d,B[9]=y,B[10]=k,B[11]=O,B[12]=D,B[13]=U,B[14]=X,B[15]=Y,B}function o(n,c){const s=c??new i(16);return s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=0,s[4]=n[4],s[5]=n[5],s[6]=n[6],s[7]=0,s[8]=n[8],s[9]=n[9],s[10]=n[10],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function f(n,c){const s=c??new i(16),a=n[0],p=n[1],b=n[2],C=n[3],u=a+a,d=p+p,y=b+b,k=a*u,O=p*u,D=p*d,U=b*u,X=b*d,Y=b*y,G=C*u,B=C*d,tt=C*y;return s[0]=1-D-Y,s[1]=O+tt,s[2]=U-B,s[3]=0,s[4]=O-tt,s[5]=1-k-Y,s[6]=X+G,s[7]=0,s[8]=U+B,s[9]=X-G,s[10]=1-k-D,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function S(n,c){const s=c??new i(16);return s[0]=-n[0],s[1]=-n[1],s[2]=-n[2],s[3]=-n[3],s[4]=-n[4],s[5]=-n[5],s[6]=-n[6],s[7]=-n[7],s[8]=-n[8],s[9]=-n[9],s[10]=-n[10],s[11]=-n[11],s[12]=-n[12],s[13]=-n[13],s[14]=-n[14],s[15]=-n[15],s}function A(n,c){const s=c??new i(16);return s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=n[3],s[4]=n[4],s[5]=n[5],s[6]=n[6],s[7]=n[7],s[8]=n[8],s[9]=n[9],s[10]=n[10],s[11]=n[11],s[12]=n[12],s[13]=n[13],s[14]=n[14],s[15]=n[15],s}const q=A;function V(n,c){return Math.abs(n[0]-c[0])<K&&Math.abs(n[1]-c[1])<K&&Math.abs(n[2]-c[2])<K&&Math.abs(n[3]-c[3])<K&&Math.abs(n[4]-c[4])<K&&Math.abs(n[5]-c[5])<K&&Math.abs(n[6]-c[6])<K&&Math.abs(n[7]-c[7])<K&&Math.abs(n[8]-c[8])<K&&Math.abs(n[9]-c[9])<K&&Math.abs(n[10]-c[10])<K&&Math.abs(n[11]-c[11])<K&&Math.abs(n[12]-c[12])<K&&Math.abs(n[13]-c[13])<K&&Math.abs(n[14]-c[14])<K&&Math.abs(n[15]-c[15])<K}function Z(n,c){return n[0]===c[0]&&n[1]===c[1]&&n[2]===c[2]&&n[3]===c[3]&&n[4]===c[4]&&n[5]===c[5]&&n[6]===c[6]&&n[7]===c[7]&&n[8]===c[8]&&n[9]===c[9]&&n[10]===c[10]&&n[11]===c[11]&&n[12]===c[12]&&n[13]===c[13]&&n[14]===c[14]&&n[15]===c[15]}function at(n){const c=n??new i(16);return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function wt(n,c){const s=c??new i(16);if(s===n){let rt;return rt=n[1],n[1]=n[4],n[4]=rt,rt=n[2],n[2]=n[8],n[8]=rt,rt=n[3],n[3]=n[12],n[12]=rt,rt=n[6],n[6]=n[9],n[9]=rt,rt=n[7],n[7]=n[13],n[13]=rt,rt=n[11],n[11]=n[14],n[14]=rt,s}const a=n[0*4+0],p=n[0*4+1],b=n[0*4+2],C=n[0*4+3],u=n[1*4+0],d=n[1*4+1],y=n[1*4+2],k=n[1*4+3],O=n[2*4+0],D=n[2*4+1],U=n[2*4+2],X=n[2*4+3],Y=n[3*4+0],G=n[3*4+1],B=n[3*4+2],tt=n[3*4+3];return s[0]=a,s[1]=u,s[2]=O,s[3]=Y,s[4]=p,s[5]=d,s[6]=D,s[7]=G,s[8]=b,s[9]=y,s[10]=U,s[11]=B,s[12]=C,s[13]=k,s[14]=X,s[15]=tt,s}function mt(n,c){const s=c??new i(16),a=n[0*4+0],p=n[0*4+1],b=n[0*4+2],C=n[0*4+3],u=n[1*4+0],d=n[1*4+1],y=n[1*4+2],k=n[1*4+3],O=n[2*4+0],D=n[2*4+1],U=n[2*4+2],X=n[2*4+3],Y=n[3*4+0],G=n[3*4+1],B=n[3*4+2],tt=n[3*4+3],rt=U*tt,dt=B*X,yt=y*tt,gt=B*k,bt=y*X,Et=U*k,Tt=b*tt,Mt=B*C,St=b*X,Nt=U*C,Ct=b*k,Ut=y*C,Rt=O*G,Ft=Y*D,Wt=u*G,Xt=Y*d,Ht=u*D,Ze=O*d,je=a*G,Je=Y*p,Ke=a*D,tn=O*p,en=a*d,nn=u*p,Gn=rt*d+gt*D+bt*G-(dt*d+yt*D+Et*G),Vn=dt*p+Tt*D+Nt*G-(rt*p+Mt*D+St*G),Bn=yt*p+Mt*d+Ct*G-(gt*p+Tt*d+Ut*G),Wn=Et*p+St*d+Ut*D-(bt*p+Nt*d+Ct*D),Ot=1/(a*Gn+u*Vn+O*Bn+Y*Wn);return s[0]=Ot*Gn,s[1]=Ot*Vn,s[2]=Ot*Bn,s[3]=Ot*Wn,s[4]=Ot*(dt*u+yt*O+Et*Y-(rt*u+gt*O+bt*Y)),s[5]=Ot*(rt*a+Mt*O+St*Y-(dt*a+Tt*O+Nt*Y)),s[6]=Ot*(gt*a+Tt*u+Ut*Y-(yt*a+Mt*u+Ct*Y)),s[7]=Ot*(bt*a+Nt*u+Ct*O-(Et*a+St*u+Ut*O)),s[8]=Ot*(Rt*k+Xt*X+Ht*tt-(Ft*k+Wt*X+Ze*tt)),s[9]=Ot*(Ft*C+je*X+tn*tt-(Rt*C+Je*X+Ke*tt)),s[10]=Ot*(Wt*C+Je*k+en*tt-(Xt*C+je*k+nn*tt)),s[11]=Ot*(Ze*C+Ke*k+nn*X-(Ht*C+tn*k+en*X)),s[12]=Ot*(Wt*U+Ze*B+Ft*y-(Ht*B+Rt*y+Xt*U)),s[13]=Ot*(Ke*B+Rt*b+Je*U-(je*U+tn*B+Ft*b)),s[14]=Ot*(je*y+nn*B+Xt*b-(en*B+Wt*b+Je*y)),s[15]=Ot*(en*U+Ht*b+tn*y-(Ke*y+nn*U+Ze*b)),s}function xt(n){const c=n[0],s=n[0*4+1],a=n[0*4+2],p=n[0*4+3],b=n[1*4+0],C=n[1*4+1],u=n[1*4+2],d=n[1*4+3],y=n[2*4+0],k=n[2*4+1],O=n[2*4+2],D=n[2*4+3],U=n[3*4+0],X=n[3*4+1],Y=n[3*4+2],G=n[3*4+3],B=O*G,tt=Y*D,rt=u*G,dt=Y*d,yt=u*D,gt=O*d,bt=a*G,Et=Y*p,Tt=a*D,Mt=O*p,St=a*d,Nt=u*p,Ct=B*C+dt*k+yt*X-(tt*C+rt*k+gt*X),Ut=tt*s+bt*k+Mt*X-(B*s+Et*k+Tt*X),Rt=rt*s+Et*C+St*X-(dt*s+bt*C+Nt*X),Ft=gt*s+Tt*C+Nt*k-(yt*s+Mt*C+St*k);return c*Ct+b*Ut+y*Rt+U*Ft}const It=mt;function Lt(n,c,s){const a=s??new i(16),p=n[0],b=n[1],C=n[2],u=n[3],d=n[4],y=n[5],k=n[6],O=n[7],D=n[8],U=n[9],X=n[10],Y=n[11],G=n[12],B=n[13],tt=n[14],rt=n[15],dt=c[0],yt=c[1],gt=c[2],bt=c[3],Et=c[4],Tt=c[5],Mt=c[6],St=c[7],Nt=c[8],Ct=c[9],Ut=c[10],Rt=c[11],Ft=c[12],Wt=c[13],Xt=c[14],Ht=c[15];return a[0]=p*dt+d*yt+D*gt+G*bt,a[1]=b*dt+y*yt+U*gt+B*bt,a[2]=C*dt+k*yt+X*gt+tt*bt,a[3]=u*dt+O*yt+Y*gt+rt*bt,a[4]=p*Et+d*Tt+D*Mt+G*St,a[5]=b*Et+y*Tt+U*Mt+B*St,a[6]=C*Et+k*Tt+X*Mt+tt*St,a[7]=u*Et+O*Tt+Y*Mt+rt*St,a[8]=p*Nt+d*Ct+D*Ut+G*Rt,a[9]=b*Nt+y*Ct+U*Ut+B*Rt,a[10]=C*Nt+k*Ct+X*Ut+tt*Rt,a[11]=u*Nt+O*Ct+Y*Ut+rt*Rt,a[12]=p*Ft+d*Wt+D*Xt+G*Ht,a[13]=b*Ft+y*Wt+U*Xt+B*Ht,a[14]=C*Ft+k*Wt+X*Xt+tt*Ht,a[15]=u*Ft+O*Wt+Y*Xt+rt*Ht,a}const Yt=Lt;function Pt(n,c,s){const a=s??at();return n!==a&&(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[8]=n[8],a[9]=n[9],a[10]=n[10],a[11]=n[11]),a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a}function Dt(n,c){const s=c??t.create();return s[0]=n[12],s[1]=n[13],s[2]=n[14],s}function Zt(n,c,s){const a=s??t.create(),p=c*4;return a[0]=n[p+0],a[1]=n[p+1],a[2]=n[p+2],a}function zt(n,c,s,a){const p=a===n?a:A(n,a),b=s*4;return p[b+0]=c[0],p[b+1]=c[1],p[b+2]=c[2],p}function Gt(n,c){const s=c??t.create(),a=n[0],p=n[1],b=n[2],C=n[4],u=n[5],d=n[6],y=n[8],k=n[9],O=n[10];return s[0]=Math.sqrt(a*a+p*p+b*b),s[1]=Math.sqrt(C*C+u*u+d*d),s[2]=Math.sqrt(y*y+k*k+O*O),s}function Qt(n,c,s,a,p){const b=p??new i(16),C=Math.tan(Math.PI*.5-.5*n);if(b[0]=C/c,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=C,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[11]=-1,b[12]=0,b[13]=0,b[15]=0,Number.isFinite(a)){const u=1/(s-a);b[10]=a*u,b[14]=a*s*u}else b[10]=-1,b[14]=-s;return b}function Vt(n,c,s,a=1/0,p){const b=p??new i(16),C=1/Math.tan(n*.5);if(b[0]=C/c,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=C,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[11]=-1,b[12]=0,b[13]=0,b[15]=0,a===1/0)b[10]=0,b[14]=s;else{const u=1/(a-s);b[10]=s*u,b[14]=a*s*u}return b}function Bt(n,c,s,a,p,b,C){const u=C??new i(16);return u[0]=2/(c-n),u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=2/(a-s),u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1/(p-b),u[11]=0,u[12]=(c+n)/(n-c),u[13]=(a+s)/(s-a),u[14]=p/(p-b),u[15]=1,u}function vt(n,c,s,a,p,b,C){const u=C??new i(16),d=c-n,y=a-s,k=p-b;return u[0]=2*p/d,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=2*p/y,u[6]=0,u[7]=0,u[8]=(n+c)/d,u[9]=(a+s)/y,u[10]=b/k,u[11]=-1,u[12]=0,u[13]=0,u[14]=p*b/k,u[15]=0,u}function jt(n,c,s,a,p,b=1/0,C){const u=C??new i(16),d=c-n,y=a-s;if(u[0]=2*p/d,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=2*p/y,u[6]=0,u[7]=0,u[8]=(n+c)/d,u[9]=(a+s)/y,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,b===1/0)u[10]=0,u[14]=p;else{const k=1/(b-p);u[10]=p*k,u[14]=b*p*k}return u}const st=t.create(),ct=t.create(),et=t.create();function w(n,c,s,a){const p=a??new i(16);return t.normalize(t.subtract(c,n,et),et),t.normalize(t.cross(s,et,st),st),t.normalize(t.cross(et,st,ct),ct),p[0]=st[0],p[1]=st[1],p[2]=st[2],p[3]=0,p[4]=ct[0],p[5]=ct[1],p[6]=ct[2],p[7]=0,p[8]=et[0],p[9]=et[1],p[10]=et[2],p[11]=0,p[12]=n[0],p[13]=n[1],p[14]=n[2],p[15]=1,p}function P(n,c,s,a){const p=a??new i(16);return t.normalize(t.subtract(n,c,et),et),t.normalize(t.cross(s,et,st),st),t.normalize(t.cross(et,st,ct),ct),p[0]=st[0],p[1]=st[1],p[2]=st[2],p[3]=0,p[4]=ct[0],p[5]=ct[1],p[6]=ct[2],p[7]=0,p[8]=et[0],p[9]=et[1],p[10]=et[2],p[11]=0,p[12]=n[0],p[13]=n[1],p[14]=n[2],p[15]=1,p}function N(n,c,s,a){const p=a??new i(16);return t.normalize(t.subtract(n,c,et),et),t.normalize(t.cross(s,et,st),st),t.normalize(t.cross(et,st,ct),ct),p[0]=st[0],p[1]=ct[0],p[2]=et[0],p[3]=0,p[4]=st[1],p[5]=ct[1],p[6]=et[1],p[7]=0,p[8]=st[2],p[9]=ct[2],p[10]=et[2],p[11]=0,p[12]=-(st[0]*n[0]+st[1]*n[1]+st[2]*n[2]),p[13]=-(ct[0]*n[0]+ct[1]*n[1]+ct[2]*n[2]),p[14]=-(et[0]*n[0]+et[1]*n[1]+et[2]*n[2]),p[15]=1,p}function R(n,c){const s=c??new i(16);return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=n[0],s[13]=n[1],s[14]=n[2],s[15]=1,s}function W(n,c,s){const a=s??new i(16),p=c[0],b=c[1],C=c[2],u=n[0],d=n[1],y=n[2],k=n[3],O=n[1*4+0],D=n[1*4+1],U=n[1*4+2],X=n[1*4+3],Y=n[2*4+0],G=n[2*4+1],B=n[2*4+2],tt=n[2*4+3],rt=n[3*4+0],dt=n[3*4+1],yt=n[3*4+2],gt=n[3*4+3];return n!==a&&(a[0]=u,a[1]=d,a[2]=y,a[3]=k,a[4]=O,a[5]=D,a[6]=U,a[7]=X,a[8]=Y,a[9]=G,a[10]=B,a[11]=tt),a[12]=u*p+O*b+Y*C+rt,a[13]=d*p+D*b+G*C+dt,a[14]=y*p+U*b+B*C+yt,a[15]=k*p+X*b+tt*C+gt,a}function z(n,c){const s=c??new i(16),a=Math.cos(n),p=Math.sin(n);return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=a,s[6]=p,s[7]=0,s[8]=0,s[9]=-p,s[10]=a,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function j(n,c,s){const a=s??new i(16),p=n[4],b=n[5],C=n[6],u=n[7],d=n[8],y=n[9],k=n[10],O=n[11],D=Math.cos(c),U=Math.sin(c);return a[4]=D*p+U*d,a[5]=D*b+U*y,a[6]=D*C+U*k,a[7]=D*u+U*O,a[8]=D*d-U*p,a[9]=D*y-U*b,a[10]=D*k-U*C,a[11]=D*O-U*u,n!==a&&(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a}function J(n,c){const s=c??new i(16),a=Math.cos(n),p=Math.sin(n);return s[0]=a,s[1]=0,s[2]=-p,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=p,s[9]=0,s[10]=a,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function nt(n,c,s){const a=s??new i(16),p=n[0*4+0],b=n[0*4+1],C=n[0*4+2],u=n[0*4+3],d=n[2*4+0],y=n[2*4+1],k=n[2*4+2],O=n[2*4+3],D=Math.cos(c),U=Math.sin(c);return a[0]=D*p-U*d,a[1]=D*b-U*y,a[2]=D*C-U*k,a[3]=D*u-U*O,a[8]=D*d+U*p,a[9]=D*y+U*b,a[10]=D*k+U*C,a[11]=D*O+U*u,n!==a&&(a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a}function H(n,c){const s=c??new i(16),a=Math.cos(n),p=Math.sin(n);return s[0]=a,s[1]=p,s[2]=0,s[3]=0,s[4]=-p,s[5]=a,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Q(n,c,s){const a=s??new i(16),p=n[0*4+0],b=n[0*4+1],C=n[0*4+2],u=n[0*4+3],d=n[1*4+0],y=n[1*4+1],k=n[1*4+2],O=n[1*4+3],D=Math.cos(c),U=Math.sin(c);return a[0]=D*p+U*d,a[1]=D*b+U*y,a[2]=D*C+U*k,a[3]=D*u+U*O,a[4]=D*d-U*p,a[5]=D*y-U*b,a[6]=D*k-U*C,a[7]=D*O-U*u,n!==a&&(a[8]=n[8],a[9]=n[9],a[10]=n[10],a[11]=n[11],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a}function it(n,c,s){const a=s??new i(16);let p=n[0],b=n[1],C=n[2];const u=Math.sqrt(p*p+b*b+C*C);p/=u,b/=u,C/=u;const d=p*p,y=b*b,k=C*C,O=Math.cos(c),D=Math.sin(c),U=1-O;return a[0]=d+(1-d)*O,a[1]=p*b*U+C*D,a[2]=p*C*U-b*D,a[3]=0,a[4]=p*b*U-C*D,a[5]=y+(1-y)*O,a[6]=b*C*U+p*D,a[7]=0,a[8]=p*C*U+b*D,a[9]=b*C*U-p*D,a[10]=k+(1-k)*O,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}const E=it;function F(n,c,s,a){const p=a??new i(16);let b=c[0],C=c[1],u=c[2];const d=Math.sqrt(b*b+C*C+u*u);b/=d,C/=d,u/=d;const y=b*b,k=C*C,O=u*u,D=Math.cos(s),U=Math.sin(s),X=1-D,Y=y+(1-y)*D,G=b*C*X+u*U,B=b*u*X-C*U,tt=b*C*X-u*U,rt=k+(1-k)*D,dt=C*u*X+b*U,yt=b*u*X+C*U,gt=C*u*X-b*U,bt=O+(1-O)*D,Et=n[0],Tt=n[1],Mt=n[2],St=n[3],Nt=n[4],Ct=n[5],Ut=n[6],Rt=n[7],Ft=n[8],Wt=n[9],Xt=n[10],Ht=n[11];return p[0]=Y*Et+G*Nt+B*Ft,p[1]=Y*Tt+G*Ct+B*Wt,p[2]=Y*Mt+G*Ut+B*Xt,p[3]=Y*St+G*Rt+B*Ht,p[4]=tt*Et+rt*Nt+dt*Ft,p[5]=tt*Tt+rt*Ct+dt*Wt,p[6]=tt*Mt+rt*Ut+dt*Xt,p[7]=tt*St+rt*Rt+dt*Ht,p[8]=yt*Et+gt*Nt+bt*Ft,p[9]=yt*Tt+gt*Ct+bt*Wt,p[10]=yt*Mt+gt*Ut+bt*Xt,p[11]=yt*St+gt*Rt+bt*Ht,n!==p&&(p[12]=n[12],p[13]=n[13],p[14]=n[14],p[15]=n[15]),p}const l=F;function _(n,c){const s=c??new i(16);return s[0]=n[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=n[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=n[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function m(n,c,s){const a=s??new i(16),p=c[0],b=c[1],C=c[2];return a[0]=p*n[0*4+0],a[1]=p*n[0*4+1],a[2]=p*n[0*4+2],a[3]=p*n[0*4+3],a[4]=b*n[1*4+0],a[5]=b*n[1*4+1],a[6]=b*n[1*4+2],a[7]=b*n[1*4+3],a[8]=C*n[2*4+0],a[9]=C*n[2*4+1],a[10]=C*n[2*4+2],a[11]=C*n[2*4+3],n!==a&&(a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a}function v(n,c){const s=c??new i(16);return s[0]=n,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=n,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=n,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function I(n,c,s){const a=s??new i(16);return a[0]=c*n[0*4+0],a[1]=c*n[0*4+1],a[2]=c*n[0*4+2],a[3]=c*n[0*4+3],a[4]=c*n[1*4+0],a[5]=c*n[1*4+1],a[6]=c*n[1*4+2],a[7]=c*n[1*4+3],a[8]=c*n[2*4+0],a[9]=c*n[2*4+1],a[10]=c*n[2*4+2],a[11]=c*n[2*4+3],n!==a&&(a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a}return{create:e,set:r,fromMat3:o,fromQuat:f,negate:S,copy:A,clone:q,equalsApproximately:V,equals:Z,identity:at,transpose:wt,inverse:mt,determinant:xt,invert:It,multiply:Lt,mul:Yt,setTranslation:Pt,getTranslation:Dt,getAxis:Zt,setAxis:zt,getScaling:Gt,perspective:Qt,perspectiveReverseZ:Vt,ortho:Bt,frustum:vt,frustumReverseZ:jt,aim:w,cameraAim:P,lookAt:N,translation:R,translate:W,rotationX:z,rotateX:j,rotationY:J,rotateY:nt,rotationZ:H,rotateZ:Q,axisRotation:it,rotation:E,axisRotate:F,rotate:l,scaling:_,scale:m,uniformScaling:v,uniformScale:I}}const fr=new Map;function ui(i){let t=fr.get(i);return t||(t=oi(i),fr.set(i,t)),t}function ci(i){const t=Ln(i);function e(E,F,l,_){const m=new i(4);return E!==void 0&&(m[0]=E,F!==void 0&&(m[1]=F,l!==void 0&&(m[2]=l,_!==void 0&&(m[3]=_)))),m}const r=e;function o(E,F,l,_,m){const v=m??new i(4);return v[0]=E,v[1]=F,v[2]=l,v[3]=_,v}function f(E,F,l){const _=l??new i(4),m=F*.5,v=Math.sin(m);return _[0]=v*E[0],_[1]=v*E[1],_[2]=v*E[2],_[3]=Math.cos(m),_}function S(E,F){const l=F??t.create(3),_=Math.acos(E[3])*2,m=Math.sin(_*.5);return m>K?(l[0]=E[0]/m,l[1]=E[1]/m,l[2]=E[2]/m):(l[0]=1,l[1]=0,l[2]=0),{angle:_,axis:l}}function A(E,F){const l=vt(E,F);return Math.acos(2*l*l-1)}function q(E,F,l){const _=l??new i(4),m=E[0],v=E[1],I=E[2],n=E[3],c=F[0],s=F[1],a=F[2],p=F[3];return _[0]=m*p+n*c+v*a-I*s,_[1]=v*p+n*s+I*c-m*a,_[2]=I*p+n*a+m*s-v*c,_[3]=n*p-m*c-v*s-I*a,_}const V=q;function Z(E,F,l){const _=l??new i(4),m=F*.5,v=E[0],I=E[1],n=E[2],c=E[3],s=Math.sin(m),a=Math.cos(m);return _[0]=v*a+c*s,_[1]=I*a+n*s,_[2]=n*a-I*s,_[3]=c*a-v*s,_}function at(E,F,l){const _=l??new i(4),m=F*.5,v=E[0],I=E[1],n=E[2],c=E[3],s=Math.sin(m),a=Math.cos(m);return _[0]=v*a-n*s,_[1]=I*a+c*s,_[2]=n*a+v*s,_[3]=c*a-I*s,_}function wt(E,F,l){const _=l??new i(4),m=F*.5,v=E[0],I=E[1],n=E[2],c=E[3],s=Math.sin(m),a=Math.cos(m);return _[0]=v*a+I*s,_[1]=I*a-v*s,_[2]=n*a+c*s,_[3]=c*a-n*s,_}function mt(E,F,l,_){const m=_??new i(4),v=E[0],I=E[1],n=E[2],c=E[3];let s=F[0],a=F[1],p=F[2],b=F[3],C=v*s+I*a+n*p+c*b;C<0&&(C=-C,s=-s,a=-a,p=-p,b=-b);let u,d;if(1-C>K){const y=Math.acos(C),k=Math.sin(y);u=Math.sin((1-l)*y)/k,d=Math.sin(l*y)/k}else u=1-l,d=l;return m[0]=u*v+d*s,m[1]=u*I+d*a,m[2]=u*n+d*p,m[3]=u*c+d*b,m}function xt(E,F){const l=F??new i(4),_=E[0],m=E[1],v=E[2],I=E[3],n=_*_+m*m+v*v+I*I,c=n?1/n:0;return l[0]=-_*c,l[1]=-m*c,l[2]=-v*c,l[3]=I*c,l}function It(E,F){const l=F??new i(4);return l[0]=-E[0],l[1]=-E[1],l[2]=-E[2],l[3]=E[3],l}function Lt(E,F){const l=F??new i(4),_=E[0]+E[5]+E[10];if(_>0){const m=Math.sqrt(_+1);l[3]=.5*m;const v=.5/m;l[0]=(E[6]-E[9])*v,l[1]=(E[8]-E[2])*v,l[2]=(E[1]-E[4])*v}else{let m=0;E[5]>E[0]&&(m=1),E[10]>E[m*4+m]&&(m=2);const v=(m+1)%3,I=(m+2)%3,n=Math.sqrt(E[m*4+m]-E[v*4+v]-E[I*4+I]+1);l[m]=.5*n;const c=.5/n;l[3]=(E[v*4+I]-E[I*4+v])*c,l[v]=(E[v*4+m]+E[m*4+v])*c,l[I]=(E[I*4+m]+E[m*4+I])*c}return l}function Yt(E,F,l,_,m){const v=m??new i(4),I=E*.5,n=F*.5,c=l*.5,s=Math.sin(I),a=Math.cos(I),p=Math.sin(n),b=Math.cos(n),C=Math.sin(c),u=Math.cos(c);switch(_){case"xyz":v[0]=s*b*u+a*p*C,v[1]=a*p*u-s*b*C,v[2]=a*b*C+s*p*u,v[3]=a*b*u-s*p*C;break;case"xzy":v[0]=s*b*u-a*p*C,v[1]=a*p*u-s*b*C,v[2]=a*b*C+s*p*u,v[3]=a*b*u+s*p*C;break;case"yxz":v[0]=s*b*u+a*p*C,v[1]=a*p*u-s*b*C,v[2]=a*b*C-s*p*u,v[3]=a*b*u+s*p*C;break;case"yzx":v[0]=s*b*u+a*p*C,v[1]=a*p*u+s*b*C,v[2]=a*b*C-s*p*u,v[3]=a*b*u-s*p*C;break;case"zxy":v[0]=s*b*u-a*p*C,v[1]=a*p*u+s*b*C,v[2]=a*b*C+s*p*u,v[3]=a*b*u-s*p*C;break;case"zyx":v[0]=s*b*u-a*p*C,v[1]=a*p*u+s*b*C,v[2]=a*b*C-s*p*u,v[3]=a*b*u+s*p*C;break;default:throw new Error(`Unknown rotation order: ${_}`)}return v}function Pt(E,F){const l=F??new i(4);return l[0]=E[0],l[1]=E[1],l[2]=E[2],l[3]=E[3],l}const Dt=Pt;function Zt(E,F,l){const _=l??new i(4);return _[0]=E[0]+F[0],_[1]=E[1]+F[1],_[2]=E[2]+F[2],_[3]=E[3]+F[3],_}function zt(E,F,l){const _=l??new i(4);return _[0]=E[0]-F[0],_[1]=E[1]-F[1],_[2]=E[2]-F[2],_[3]=E[3]-F[3],_}const Gt=zt;function Qt(E,F,l){const _=l??new i(4);return _[0]=E[0]*F,_[1]=E[1]*F,_[2]=E[2]*F,_[3]=E[3]*F,_}const Vt=Qt;function Bt(E,F,l){const _=l??new i(4);return _[0]=E[0]/F,_[1]=E[1]/F,_[2]=E[2]/F,_[3]=E[3]/F,_}function vt(E,F){return E[0]*F[0]+E[1]*F[1]+E[2]*F[2]+E[3]*F[3]}function jt(E,F,l,_){const m=_??new i(4);return m[0]=E[0]+l*(F[0]-E[0]),m[1]=E[1]+l*(F[1]-E[1]),m[2]=E[2]+l*(F[2]-E[2]),m[3]=E[3]+l*(F[3]-E[3]),m}function st(E){const F=E[0],l=E[1],_=E[2],m=E[3];return Math.sqrt(F*F+l*l+_*_+m*m)}const ct=st;function et(E){const F=E[0],l=E[1],_=E[2],m=E[3];return F*F+l*l+_*_+m*m}const w=et;function P(E,F){const l=F??new i(4),_=E[0],m=E[1],v=E[2],I=E[3],n=Math.sqrt(_*_+m*m+v*v+I*I);return n>1e-5?(l[0]=_/n,l[1]=m/n,l[2]=v/n,l[3]=I/n):(l[0]=0,l[1]=0,l[2]=0,l[3]=1),l}function N(E,F){return Math.abs(E[0]-F[0])<K&&Math.abs(E[1]-F[1])<K&&Math.abs(E[2]-F[2])<K&&Math.abs(E[3]-F[3])<K}function R(E,F){return E[0]===F[0]&&E[1]===F[1]&&E[2]===F[2]&&E[3]===F[3]}function W(E){const F=E??new i(4);return F[0]=0,F[1]=0,F[2]=0,F[3]=1,F}const z=t.create(),j=t.create(),J=t.create();function nt(E,F,l){const _=l??new i(4),m=t.dot(E,F);return m<-.999999?(t.cross(j,E,z),t.len(z)<1e-6&&t.cross(J,E,z),t.normalize(z,z),f(z,Math.PI,_),_):m>.999999?(_[0]=0,_[1]=0,_[2]=0,_[3]=1,_):(t.cross(E,F,z),_[0]=z[0],_[1]=z[1],_[2]=z[2],_[3]=1+m,P(_,_))}const H=new i(4),Q=new i(4);function it(E,F,l,_,m,v){const I=v??new i(4);return mt(E,_,m,H),mt(F,l,m,Q),mt(H,Q,2*m*(1-m),I),I}return{create:e,fromValues:r,set:o,fromAxisAngle:f,toAxisAngle:S,angle:A,multiply:q,mul:V,rotateX:Z,rotateY:at,rotateZ:wt,slerp:mt,inverse:xt,conjugate:It,fromMat:Lt,fromEuler:Yt,copy:Pt,clone:Dt,add:Zt,subtract:zt,sub:Gt,mulScalar:Qt,scale:Vt,divScalar:Bt,dot:vt,lerp:jt,length:st,len:ct,lengthSq:et,lenSq:w,normalize:P,equalsApproximately:N,equals:R,identity:W,rotationTo:nt,sqlerp:it}}const mr=new Map;function hi(i){let t=mr.get(i);return t||(t=ci(i),mr.set(i,t)),t}function li(i){function t(l,_,m,v){const I=new i(4);return l!==void 0&&(I[0]=l,_!==void 0&&(I[1]=_,m!==void 0&&(I[2]=m,v!==void 0&&(I[3]=v)))),I}const e=t;function r(l,_,m,v,I){const n=I??new i(4);return n[0]=l,n[1]=_,n[2]=m,n[3]=v,n}function o(l,_){const m=_??new i(4);return m[0]=Math.ceil(l[0]),m[1]=Math.ceil(l[1]),m[2]=Math.ceil(l[2]),m[3]=Math.ceil(l[3]),m}function f(l,_){const m=_??new i(4);return m[0]=Math.floor(l[0]),m[1]=Math.floor(l[1]),m[2]=Math.floor(l[2]),m[3]=Math.floor(l[3]),m}function S(l,_){const m=_??new i(4);return m[0]=Math.round(l[0]),m[1]=Math.round(l[1]),m[2]=Math.round(l[2]),m[3]=Math.round(l[3]),m}function A(l,_=0,m=1,v){const I=v??new i(4);return I[0]=Math.min(m,Math.max(_,l[0])),I[1]=Math.min(m,Math.max(_,l[1])),I[2]=Math.min(m,Math.max(_,l[2])),I[3]=Math.min(m,Math.max(_,l[3])),I}function q(l,_,m){const v=m??new i(4);return v[0]=l[0]+_[0],v[1]=l[1]+_[1],v[2]=l[2]+_[2],v[3]=l[3]+_[3],v}function V(l,_,m,v){const I=v??new i(4);return I[0]=l[0]+_[0]*m,I[1]=l[1]+_[1]*m,I[2]=l[2]+_[2]*m,I[3]=l[3]+_[3]*m,I}function Z(l,_,m){const v=m??new i(4);return v[0]=l[0]-_[0],v[1]=l[1]-_[1],v[2]=l[2]-_[2],v[3]=l[3]-_[3],v}const at=Z;function wt(l,_){return Math.abs(l[0]-_[0])<K&&Math.abs(l[1]-_[1])<K&&Math.abs(l[2]-_[2])<K&&Math.abs(l[3]-_[3])<K}function mt(l,_){return l[0]===_[0]&&l[1]===_[1]&&l[2]===_[2]&&l[3]===_[3]}function xt(l,_,m,v){const I=v??new i(4);return I[0]=l[0]+m*(_[0]-l[0]),I[1]=l[1]+m*(_[1]-l[1]),I[2]=l[2]+m*(_[2]-l[2]),I[3]=l[3]+m*(_[3]-l[3]),I}function It(l,_,m,v){const I=v??new i(4);return I[0]=l[0]+m[0]*(_[0]-l[0]),I[1]=l[1]+m[1]*(_[1]-l[1]),I[2]=l[2]+m[2]*(_[2]-l[2]),I[3]=l[3]+m[3]*(_[3]-l[3]),I}function Lt(l,_,m){const v=m??new i(4);return v[0]=Math.max(l[0],_[0]),v[1]=Math.max(l[1],_[1]),v[2]=Math.max(l[2],_[2]),v[3]=Math.max(l[3],_[3]),v}function Yt(l,_,m){const v=m??new i(4);return v[0]=Math.min(l[0],_[0]),v[1]=Math.min(l[1],_[1]),v[2]=Math.min(l[2],_[2]),v[3]=Math.min(l[3],_[3]),v}function Pt(l,_,m){const v=m??new i(4);return v[0]=l[0]*_,v[1]=l[1]*_,v[2]=l[2]*_,v[3]=l[3]*_,v}const Dt=Pt;function Zt(l,_,m){const v=m??new i(4);return v[0]=l[0]/_,v[1]=l[1]/_,v[2]=l[2]/_,v[3]=l[3]/_,v}function zt(l,_){const m=_??new i(4);return m[0]=1/l[0],m[1]=1/l[1],m[2]=1/l[2],m[3]=1/l[3],m}const Gt=zt;function Qt(l,_){return l[0]*_[0]+l[1]*_[1]+l[2]*_[2]+l[3]*_[3]}function Vt(l){const _=l[0],m=l[1],v=l[2],I=l[3];return Math.sqrt(_*_+m*m+v*v+I*I)}const Bt=Vt;function vt(l){const _=l[0],m=l[1],v=l[2],I=l[3];return _*_+m*m+v*v+I*I}const jt=vt;function st(l,_){const m=l[0]-_[0],v=l[1]-_[1],I=l[2]-_[2],n=l[3]-_[3];return Math.sqrt(m*m+v*v+I*I+n*n)}const ct=st;function et(l,_){const m=l[0]-_[0],v=l[1]-_[1],I=l[2]-_[2],n=l[3]-_[3];return m*m+v*v+I*I+n*n}const w=et;function P(l,_){const m=_??new i(4),v=l[0],I=l[1],n=l[2],c=l[3],s=Math.sqrt(v*v+I*I+n*n+c*c);return s>1e-5?(m[0]=v/s,m[1]=I/s,m[2]=n/s,m[3]=c/s):(m[0]=0,m[1]=0,m[2]=0,m[3]=0),m}function N(l,_){const m=_??new i(4);return m[0]=-l[0],m[1]=-l[1],m[2]=-l[2],m[3]=-l[3],m}function R(l,_){const m=_??new i(4);return m[0]=l[0],m[1]=l[1],m[2]=l[2],m[3]=l[3],m}const W=R;function z(l,_,m){const v=m??new i(4);return v[0]=l[0]*_[0],v[1]=l[1]*_[1],v[2]=l[2]*_[2],v[3]=l[3]*_[3],v}const j=z;function J(l,_,m){const v=m??new i(4);return v[0]=l[0]/_[0],v[1]=l[1]/_[1],v[2]=l[2]/_[2],v[3]=l[3]/_[3],v}const nt=J;function H(l){const _=l??new i(4);return _[0]=0,_[1]=0,_[2]=0,_[3]=0,_}function Q(l,_,m){const v=m??new i(4),I=l[0],n=l[1],c=l[2],s=l[3];return v[0]=_[0]*I+_[4]*n+_[8]*c+_[12]*s,v[1]=_[1]*I+_[5]*n+_[9]*c+_[13]*s,v[2]=_[2]*I+_[6]*n+_[10]*c+_[14]*s,v[3]=_[3]*I+_[7]*n+_[11]*c+_[15]*s,v}function it(l,_,m){const v=m??new i(4);return P(l,v),Pt(v,_,v)}function E(l,_,m){const v=m??new i(4);return Vt(l)>_?it(l,_,v):R(l,v)}function F(l,_,m){const v=m??new i(4);return xt(l,_,.5,v)}return{create:t,fromValues:e,set:r,ceil:o,floor:f,round:S,clamp:A,add:q,addScaled:V,subtract:Z,sub:at,equalsApproximately:wt,equals:mt,lerp:xt,lerpV:It,max:Lt,min:Yt,mulScalar:Pt,scale:Dt,divScalar:Zt,inverse:zt,invert:Gt,dot:Qt,length:Vt,len:Bt,lengthSq:vt,lenSq:jt,distance:st,dist:ct,distanceSq:et,distSq:w,normalize:P,negate:N,copy:R,clone:W,multiply:z,mul:j,divide:J,div:nt,zero:H,transformMat4:Q,setLength:it,truncate:E,midpoint:F}}const wr=new Map;function _i(i){let t=wr.get(i);return t||(t=li(i),wr.set(i,t)),t}function zn(i,t,e,r,o,f){return{mat4:ui(i),mat3:ii(t),quat:hi(e),vec2:Gr(r),vec3:Ln(o),vec4:_i(f)}}zn(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array);zn(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array);zn(ni,Array,Array,Array,Array,Array);pt({TRIANGLE:3,SQUARE:4,PENTAGON:5,HEXAGON:6,HEPTAGON:7,OCTAGON:8,NONAGON:9,DECAGON:10,DODECAGON:12});console.info("%cUWAL v0.0.8","background:#005a9c;padding:3px;color:#fff;");const di=`fn random(uv: vec2f) -> f32
{
    return fract(sin(dot(uv, vec2f(12.9898, 78.233))) * 43758.5453);
}

fn blend(base: vec3f, factor: vec3f) -> vec3f
{
    return mix(
        1 - 2 * (1 - base) * (1 - factor),
        2 * base * factor, step(base, vec3f(0.5))
    );
}

fn vignette(col: vec3f, uv: vec2f) -> vec3f
{
    var position = uv - 0.5;
    position.x *= resolution.x / resolution.y;

    var color = mix(vec3f(0.0), col, smoothstep(
        -0.25, 0.5, 1 - length(position)
    ));

    return mix(
        color,
        blend(
            color,
            vec3f(
                random(uv * 0.1),
                random(uv * 2.5),
                random(uv)
            )
        ),
        0.025
    );
}
`,pi=`const RED = 7.0 / 5.0;
const BLUE = 8.0 / 5.0;
const PI = radians(180);

override SQUARE = false;

struct input
{
    time: f32,
    mouse: vec2f,
    movement: f32
};

@group(0) @binding(1) var Texture: texture_2d<f32>;
@group(0) @binding(2) var<uniform> Input: input;
@group(0) @binding(3) var Sampler: sampler;

@vertex fn vertex(@builtin(vertex_index) index: u32) -> @builtin(position) vec4f
{
    return vec4f(GetQuadCoord(index), 0, 1);
}

@fragment fn fragment(@builtin(position) coord: vec4f) -> @location(0) vec4f
{
    // Compute position from pixel coordinates and canvas resolution:
    var position = coord.xy - resolution * 0.5;
    position.y = 1 - position.y;
    position /= resolution.y;

    // Mix mouse movement and clockwise camera rotation:
    position.x -= mix(cos(Input.time * 0.25) * 0.5, Input.mouse.x, Input.movement);
    position.y += mix(sin(Input.time * 0.25) * 0.25, Input.mouse.y, Input.movement);

    // Angle to the center of the screen:
    let angle = atan(position.y / position.x);

    // Cylindrical tunnel shape:
    var radius = length(position);

    // Squareish tunnel shape:
    if (SQUARE)
    {
        // https://www.shadertoy.com/view/Ms2SWW:
        let position2 = position * position;
        let position4 = position2 * position2;
        let position8 = position4 * position4;
        radius = pow(position8.x + position8.y, 0.125);
    }

    // Get texture UV by using radius and current angle:
    let uv = vec2f(0.25 / radius + Input.time * 0.2, angle / PI);

    // Discontinuity fix (https://iquilezles.org/articles/tunnel):
    let uvDer = vec2f(uv.x, atan(position.y / abs(position.x)) / PI);

    // Partial derivatives of \`uv\` with respect to window x and y coordinates:
    var color = textureSampleGrad(Texture, Sampler, uv, dpdx(uvDer), dpdy(uvDer)).xyz;

    // Matrix formula (https://www.youtube.com/shorts/r9tQu77XoGY):
    color = vec3f(pow(color.r, RED), color.g, pow(color.b, BLUE));

    // Circular vignette with a slight noise on screen borders:
    color = vignette(color * radius, coord.xy / resolution);

    return vec4f(color, 1);
}
`,fi=""+new URL("../bricks.jpg",import.meta.url).href,Ae=document.getElementById("scene");let $t,Vr,En=[0,0],on=-1/0,$e=-1;const Pn=(i,t=0,e=1)=>Math.max(t,Math.min(i,e));try{$t=new(await zr.RenderPipeline(Ae))}catch(i){alert(i),Ae.style.width=Ae.width=innerWidth,Ae.style.height=Ae.height=innerHeight,Ae.style.background="center / cover no-repeat url('./preview.jpg')"}function Br(){$t.SetCanvasSize(innerWidth,innerHeight),Vr=$t.ResolutionBuffer}addEventListener("resize",Br,!1);Br();const mi=()=>$e=1;addEventListener("mouseover",mi,!1);function wi(i){En[0]=Pn((i.clientX/innerWidth-.5)*1.25,-.5,.5),En[1]=Pn((i.clientY/innerHeight-.5)/1.25,-.25,.25)}addEventListener("mousemove",wi,!1);const yi=()=>$e=-1;addEventListener("mouseout",yi,!1);$t.CreatePipeline($t.CreateShaderModule([hr.Quad,hr.Resolution,di,pi]));const{buffer:Wr,Input:{time:un,mouse:cn,movement:Le}}=$t.CreateUniformBuffer("Input"),qn=new Image;qn.src=fi;qn.onload=async()=>{const i=new(await zr.Texture($t)),t=i.CopyImageToTexture(qn),e=i.CreateSampler({addressModeUV:Ys.ADDRESS.REPEAT});$t.SetBindGroups($t.CreateBindGroup($t.CreateBindGroupEntries([{buffer:Vr},t.createView(),{buffer:Wr},e]))),requestAnimationFrame(Xr)};function Xr(i){un[0]=i/1e3,cn[0]+=(En[0]-cn[0])*.025,cn[1]+=(En[1]-cn[1])*.025,Le[0]+=(un[0]-on)*$e,Le[0]=Pn(Le[0],0,1),$t.WriteBuffer(Wr,un.buffer),$t.Render(6),on=+($e>0&&Le[0]<1)*.012,on||=+($e<0&&Le[0]>-1)*.015,requestAnimationFrame(Xr),on+=un[0]}
